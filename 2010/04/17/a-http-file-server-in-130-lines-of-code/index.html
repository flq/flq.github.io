<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.8cf12ecdd1ecfc7b8f39.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{position:relative;margin:.5em 0;overflow:visible;padding:0}pre[class*=language-]>code{position:relative;border-left:10px solid #358ccb;box-shadow:-1px 0 0 0 #358ccb,0 0 0 1px #dfdfdf;background-color:#fdfdfd;background-image:linear-gradient(transparent 50%,rgba(69,142,209,.04) 0);background-size:3em 3em;background-origin:content-box;background-attachment:local}code[class*=language]{max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdfdfd;box-sizing:border-box;margin-bottom:1em}:not(pre)>code[class*=language-]{position:relative;padding:.2em;border-radius:.3em;color:#c92c2c;border:1px solid rgba(0,0,0,.1);display:inline;white-space:normal}pre[class*=language-]:after,pre[class*=language-]:before{content:"";z-index:-2;display:block;position:absolute;bottom:.75em;left:.18em;width:40%;height:20%;max-height:13em;box-shadow:0 13px 8px #979797;transform:rotate(-2deg)}:not(pre)>code[class*=language-]:after,pre[class*=language-]:after{right:.75em;left:auto;transform:rotate(2deg)}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#7d8b99}.token.punctuation{color:#5f6364}.token.boolean,.token.constant,.token.deleted,.token.function-name,.token.number,.token.property,.token.symbol,.token.tag{color:#c92c2c}.token.attr-name,.token.builtin,.token.char,.token.function,.token.inserted,.token.selector,.token.string{color:#2f9c0a}.token.entity,.token.operator,.token.url,.token.variable{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.class-name,.token.keyword{color:#1990b8}.token.important,.token.regex{color:#e90}.language-css .token.string,.style .token.string{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.important{font-weight:400}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.namespace{opacity:.7}@media screen and (max-width:767px){pre[class*=language-]:after,pre[class*=language-]:before{bottom:14px;box-shadow:none}}.token.cr:before,.token.lf:before,.token.tab:not(:empty):before{color:#e0d7d1}pre[class*=language-].line-numbers.line-numbers{padding-left:0}pre[class*=language-].line-numbers.line-numbers code{padding-left:3.8em}pre[class*=language-].line-numbers.line-numbers .line-numbers-rows{left:0}pre[class*=language-][data-line]{padding-top:0;padding-bottom:0;padding-left:0}pre[data-line] code{position:relative;padding-left:4em}pre .line-highlight{margin-top:0}

/*! normalize.css v3.0.2 | MIT License | git.io/normalize */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.container{position:relative;max-width:1260px;margin:0 auto;padding:0 20px}.column,.columns,.container{width:100%;box-sizing:border-box}.column,.columns{float:left}@media (min-width:400px){.container{width:85%;padding:0}}@media (min-width:550px){.container{width:80%}.column,.columns{margin-left:4%}.column:first-child,.columns:first-child{margin-left:0}.one.column,.one.columns{width:4.66666666667%}.two.columns{width:13.3333333333%}.three.columns{width:22%}.four.columns{width:30.6666666667%}.five.columns{width:39.3333333333%}.six.columns{width:48%}.seven.columns{width:56.6666666667%}.eight.columns{width:65.3333333333%}.nine.columns{width:74%}.ten.columns{width:82.6666666667%}.eleven.columns{width:91.3333333333%}.twelve.columns{width:100%;margin-left:0}.one-third.column{width:30.6666666667%}.two-thirds.column{width:65.3333333333%}.one-half.column{width:48%}.offset-by-one.column,.offset-by-one.columns{margin-left:8.66666666667%}.offset-by-two.column,.offset-by-two.columns{margin-left:17.3333333333%}.offset-by-three.column,.offset-by-three.columns{margin-left:26%}.offset-by-four.column,.offset-by-four.columns{margin-left:34.6666666667%}.offset-by-five.column,.offset-by-five.columns{margin-left:43.3333333333%}.offset-by-six.column,.offset-by-six.columns{margin-left:52%}.offset-by-seven.column,.offset-by-seven.columns{margin-left:60.6666666667%}.offset-by-eight.column,.offset-by-eight.columns{margin-left:69.3333333333%}.offset-by-nine.column,.offset-by-nine.columns{margin-left:78%}.offset-by-ten.column,.offset-by-ten.columns{margin-left:86.6666666667%}.offset-by-eleven.column,.offset-by-eleven.columns{margin-left:95.3333333333%}.offset-by-one-third.column,.offset-by-one-third.columns{margin-left:34.6666666667%}.offset-by-two-thirds.column,.offset-by-two-thirds.columns{margin-left:69.3333333333%}.offset-by-one-half.column,.offset-by-one-half.columns{margin-left:52%}}html{font-size:62.5%}body{font-size:1.5em;line-height:1.6;font-weight:400;font-family:Raleway,HelveticaNeue,Helvetica Neue,Helvetica,Arial,sans-serif;color:#222}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:2rem;font-weight:300}h1{font-size:4rem;line-height:1.2}h1,h2{letter-spacing:-.1rem}h2{font-size:3.6rem;line-height:1.25}h3{font-size:3rem;line-height:1.3;letter-spacing:-.1rem}h4{font-size:2.4rem;line-height:1.35;letter-spacing:-.08rem}h5{font-size:1.8rem;line-height:1.5;letter-spacing:-.05rem}h6{font-size:1.5rem;line-height:1.6;letter-spacing:0}@media (min-width:550px){h1{font-size:5rem}h2{font-size:4.2rem}h3{font-size:3.6rem}h4{font-size:3rem}h5{font-size:2.4rem}h6{font-size:1.5rem}}p{margin-top:0}a{color:#1eaedb}a:hover{color:#0fa0ce}.button,button,input[type=button],input[type=reset],input[type=submit]{display:inline-block;height:38px;padding:0 30px;color:#555;text-align:center;font-size:11px;font-weight:600;line-height:38px;letter-spacing:.1rem;text-transform:uppercase;text-decoration:none;white-space:nowrap;background-color:transparent;border-radius:4px;border:1px solid #bbb;cursor:pointer;box-sizing:border-box}.button:focus,.button:hover,button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{color:#333;border-color:#888;outline:0}.button.button-primary,button.button-primary,input[type=button].button-primary,input[type=reset].button-primary,input[type=submit].button-primary{color:#fff;background-color:#33c3f0;border-color:#33c3f0}.button.button-primary:focus,.button.button-primary:hover,button.button-primary:focus,button.button-primary:hover,input[type=button].button-primary:focus,input[type=button].button-primary:hover,input[type=reset].button-primary:focus,input[type=reset].button-primary:hover,input[type=submit].button-primary:focus,input[type=submit].button-primary:hover{color:#fff;background-color:#1eaedb;border-color:#1eaedb}input[type=email],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url],select,textarea{height:38px;padding:6px 10px;background-color:#fff;border:1px solid #d1d1d1;border-radius:4px;box-shadow:none;box-sizing:border-box}input[type=email],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url],textarea{-webkit-appearance:none;-moz-appearance:none;appearance:none}textarea{min-height:65px;padding-top:6px;padding-bottom:6px}input[type=email]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=url]:focus,select:focus,textarea:focus{border:1px solid #33c3f0;outline:0}label,legend{display:block;margin-bottom:.5rem;font-weight:600}fieldset{padding:0;border-width:0}input[type=checkbox],input[type=radio]{display:inline}label>.label-body{display:inline-block;margin-left:.5rem;font-weight:400}ul{list-style:circle inside}ol{list-style:decimal inside}ol,ul{padding-left:0;margin-top:0}ol ol,ol ul,ul ol,ul ul{margin:1.5rem 0 1.5rem 3rem;font-size:90%}li{margin-bottom:1rem}div.highlight{font-size:90%;white-space:nowrap;background:#f1f1f1;border:1px solid #e1e1e1;border-radius:4px;margin-bottom:2.5rem}code{padding:.2rem .5rem;margin:0 .2rem}pre>code{display:block;padding:1rem 1.5rem;white-space:pre}td,th{padding:12px 15px;text-align:left;border-bottom:1px solid #e1e1e1}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}.button,button{margin-bottom:1rem}fieldset,input,select,textarea{margin-bottom:1.5rem}blockquote,dl,figure,form,ol,p,pre,table,ul{margin-bottom:2.5rem}.u-full-width{width:100%;box-sizing:border-box}.u-max-full-width{max-width:100%;box-sizing:border-box}.u-pull-right{float:right}.u-pull-left{float:left}hr{margin-top:3rem;margin-bottom:3.5rem;border-width:0;border-top:1px solid #e1e1e1}.container:after,.row:after,.u-cf{content:"";display:table;clear:both}.highlight .hll{background-color:#ffc}.highlight .c{color:#999}.highlight .err{color:#a00;background-color:#faa}.highlight .k{color:#069}.highlight .o{color:#555}.highlight .cm{color:#09f;font-style:italic}.highlight .cp{color:#099}.highlight .c1,.highlight .cs{color:#999}.highlight .gd{background-color:#fcc;border:1px solid #c00}.highlight .ge{font-style:italic}.highlight .gr{color:red}.highlight .gh{color:#030}.highlight .gi{background-color:#cfc;border:1px solid #0c0}.highlight .go{color:#aaa}.highlight .gp{color:#009}.highlight .gu{color:#030}.highlight .gt{color:#9c6}.highlight .kc,.highlight .kd,.highlight .kn,.highlight .kp,.highlight .kr{color:#069}.highlight .kt{color:#078}.highlight .m{color:#f60}.highlight .s{color:#d44950}.highlight .na{color:#4f9fcf}.highlight .nb{color:#366}.highlight .nc{color:#0a8}.highlight .no{color:#360}.highlight .nd{color:#99f}.highlight .ni{color:#999}.highlight .ne{color:#c00}.highlight .nf{color:#c0f}.highlight .nl{color:#99f}.highlight .nn{color:#0cf}.highlight .nt{color:#2f6f9f}.highlight .nv{color:#033}.highlight .ow{color:#000}.highlight .w{color:#bbb}.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:#f60}.highlight .sb,.highlight .sc{color:#c30}.highlight .sd{color:#c30;font-style:italic}.highlight .s2,.highlight .se,.highlight .sh{color:#c30}.highlight .si{color:#a00}.highlight .sx{color:#c30}.highlight .sr{color:#3aa}.highlight .s1{color:#c30}.highlight .ss{color:#fc3}.highlight .bp{color:#366}.highlight .vc,.highlight .vg,.highlight .vi{color:#033}.highlight .il{color:#f60}.css .nt+.nt,.css .o,.css .o+.nt{color:#999}body{font-size:1.8em}h2,h4{font-size:2.6rem}@media (min-width:550px){h2,h4{font-size:2.7rem}}kbd{padding:.1em;border-radius:3px;border:1px solid #ccc;color:#333;display:inline-block;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 2px #fff;background-color:#f7f7f7;text-shadow:0 1px 0 #fff}figcaption{text-align:center;font-style:italic;color:#777;display:block;margin-bottom:2em}.sidebar h1{font-size:2.4em}.sidebar__sitetitle{color:#af0000}.sidebar__twitter{display:none;margin-top:2rem}.footer__twitter{display:none}.footer__copyright{float:right;font-size:.7em}.right-padded{padding-right:2rem}@media (max-width:550px){.sidebar h1,.sidebar p{margin-bottom:.5rem}.sidebar{padding-bottom:1rem;margin-bottom:1rem;border-bottom:1px solid grey}.footer__twitter{display:inline-block}}@media (min-width:550px){.sidebar h1{transform:rotate(-90deg);text-align:right;margin-top:150px;margin-bottom:100px}.sidebar__twitter{display:block}.copyright{margin-top:40px}}.sidebar p{text-align:justify;font-size:.8em}.sidebar h1 a{text-decoration:none}nav a{display:block}.pagination{margin-top:20px}.center,.pagination{text-align:center}.expand{width:80%}.teaser{margin-bottom:70px}.teaser .date{display:block;margin-top:-20px;margin-bottom:20px;text-align:right}.teaser h3 a{text-decoration:none}.page-info{text-align:right;margin-bottom:40px}article iframe,article img{display:block;margin:20px auto;max-width:100%;box-shadow:0 8px 16px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)}article .blog-post__footer iframe{box-shadow:inherit}article div.highlight{box-shadow:0 8px 16px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);scroll-behavior:auto}blockquote{background:#f9f9f9;border-left:10px solid #ccc;padding:.5em 10px;quotes:"\201C""\201D""\2018""\2019"}blockquote:before{color:#ccc;content:"\201D";font-size:4em;font-family:helvetica;line-height:.1em;margin-right:.25em;vertical-align:-.4em}div.seriestoc{background:#f9f9f9;border-left:10px solid #ccc;padding:.5em 10px;font-size:1em}div.seriestoc:before{color:#ccc;content:":";font-size:4em;font-family:helvetica;line-height:.1em;margin-right:.25em;vertical-align:-.4em}.blog-post__content>h3:first-of-type{text-align:right;border-radius:25px 25px 0 0;font-size:1.2em;background-color:#777;color:#fff;margin-bottom:0;padding:2px 20px 2px 0;font-style:italic}.blog-post__content>ol:first-of-type{list-style-type:upper-roman;background:#eff;border:1px solid #777;border-radius:0 0 25px 25px;margin-top:0;list-style-position:outside;padding:10px 10px 10px 45px}.blog-post__footer{margin:1rem 0 2rem}.article-tags{margin-left:.3rem}.article-tags--tag{margin-left:.5rem}.article-tags--tag:after{margin-left:.5rem;content:"|"}.article-tags--tag:last-child:after{content:""}.blog-post__pagination{display:flex;justify-content:space-between;margin-bottom:2rem}.blog-post__pagination--previous{text-decoration:none;margin:0 1rem}.blog-post__pagination--previous:hover{text-decoration:underline}.blog-post__pagination--previous:before{content:"\21A4   "}.blog-post__pagination--next:after{content:" \21A6"}.blog-post__pagination--next{text-decoration:none;margin:0 1rem}.blog-post__pagination--next:hover{text-decoration:underline}code.language-text{position:relative;padding:0;border-radius:.1em;margin-left:.2em;margin-right:.2em;color:#a55;border-bottom:1px solid rgba(200,100,100,.1);display:inline;white-space:normal}</style><meta name="generator" content="Gatsby 2.23.3"/><title data-react-helmet="true">A HTTP file server in 130 lines of code</title><link data-react-helmet="true" href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css"/><meta data-react-helmet="true" name="description" content="Content from Frank Quednau about dev and fields of interest."/><meta data-react-helmet="true" name="keywords" content="software-development, dotnet, web"/><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="Realfiction RSS" href="/atom.xml"/><link rel="icon" href="/favicon-32x32.png?v=1198f979e9570dca0344937fffa12794"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=1198f979e9570dca0344937fffa12794"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=1198f979e9570dca0344937fffa12794"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=1198f979e9570dca0344937fffa12794"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=1198f979e9570dca0344937fffa12794"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=1198f979e9570dca0344937fffa12794"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=1198f979e9570dca0344937fffa12794"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=1198f979e9570dca0344937fffa12794"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=1198f979e9570dca0344937fffa12794"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-5eb18f8be6b26214072d.js"/><link as="script" rel="preload" href="/framework-75da9754c2a76bbaf08a.js"/><link as="script" rel="preload" href="/app-3752ccab0f3df047c847.js"/><link as="script" rel="preload" href="/styles-9b6f388623a2ec93d35f.js"/><link as="script" rel="preload" href="/commons-1786a38fae20bdbb3746.js"/><link as="script" rel="preload" href="/component---src-templates-article-template-js-155164aabab8a9f96f3c.js"/><link as="fetch" rel="preload" href="/page-data/2010/04/17/a-http-file-server-in-130-lines-of-code/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="container"><div class="row"><div class="two columns right-padded"><div class="sidebar"><h1><a class="sidebar__sitetitle" href="/">Realfiction</a></h1><p>Content from Frank Quednau about dev and fields of interest.</p><nav><a href="/tags">Tags</a></nav><div class="sidebar__twitter"><a href="https://twitter.com/fquednau?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-show-count="false" data-show-screen-name="false">Follow @fquednau</a></div></div></div><div class="nine columns"><article><h1>A HTTP file server in 130 lines of code</h1><div class="page-info"><span>April 17, 2010</span> in<span class="article-tags"><a class="article-tags--tag" href="/tags/software-development">software-development</a><a class="article-tags--tag" href="/tags/dotnet">dotnet</a><a class="article-tags--tag" href="/tags/web">web</a></span></div><div class="blog-post__content"><p>...of which 20 deal with mapping file extensions to MIME types. </p>
<p>For an integration test I want to be able to set up an HTTP server that serves files from a directory. While I was at it I ensured that a proper directory listing and links are provided by the web server so I can browse the contents of a directory from my browser. With the aid of the <a href="http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx">HttpListener</a> this is quite easy to do.</p>
<p>The whole thing is wrapped inside a class HttpFileServer, implementing disposable.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token function">HttpFileServer</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> rootPath<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>rootPath <span class="token operator">=</span> rootPath<span class="token punctuation">;</span>
  http <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  http<span class="token punctuation">.</span>Prefixes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8889/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  http<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  http<span class="token punctuation">.</span><span class="token function">BeginGetContext</span><span class="token punctuation">(</span>requestWait<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Careful with the selection of your port. You’ll get an Exception if it is registered to another application, even if that application is not running. The <em>requestWait</em> method is a callback that allows you to react to incoming requests asynchronously. It should be implemented with the well known pattern introduced to .NEt almost a decade ago:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>http<span class="token punctuation">.</span>IsListening<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> c <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">EndGetContext</span><span class="token punctuation">(</span>ar<span class="token punctuation">)</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">BeginGetContext</span><span class="token punctuation">(</span>requestWait<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>c is of type <a href="http://msdn.microsoft.com/en-us/library/system.net.httplistenercontext.aspx">HttpListenerContext</a>. The callback will also be called when the HttpListener is stopped, hence make sure that you only do stuff when you really seem to have a legitimate request.</p>
<p>As long as you keep your method re-entrant (i.e. you do not try to keep any request-specific state in some instance variable) you should be fine with multiple requests leading to multiple threads handling those.</p>
<p>As a file server, I only need to differ between a file being requested, a directory or something I don’t know:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> url <span class="token operator">=</span> <span class="token function">tuneUrl</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>RawUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> fullPath <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">?</span> rootPath <span class="token punctuation">:</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>rootPath<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">returnDirContents</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> fullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">returnFile</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> fullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> 
  <span class="token function">return404</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The dir contents just serves some HTML. Here, especially on a computer where German umlauts are inside directory and file names, you should not forget to put the proper encoding into the HTML header:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp">context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>ContentType <span class="token operator">=</span> <span class="token string">"text/html"</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>ContentEncoding <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> sw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>OutputStream<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"&lt;html>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"&lt;head>&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">&lt;/head>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"&lt;body>&lt;ul>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>When links contain spaces, umlauts etc. modern browsers should take care about escaping them correctly into a URL request sent to the server (at least Chrome does). On the server side you need to ensure that this is converted back into things understood by the classes in System.IO, which happily deal with UTF-8 encoded strings. Thankfully there is a class in .NET, the <a href="http://msdn.microsoft.com/en-us/library/system.web.httputility.aspx">HttpUtility</a> in System.Web that will be able to do that for you:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">tuneUrl</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string character">'/'</span><span class="token punctuation">,</span> <span class="token string character">'\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  url <span class="token operator">=</span> HttpUtility<span class="token punctuation">.</span><span class="token function">UrlDecode</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> url<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>When actually hitting a file, you need to read it and write it to the appropriate output stream. Just to be on the safe side regarding file size, I chose a chunked approach:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp">context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>ContentType <span class="token operator">=</span> 
  <span class="token function">getcontentType</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">GetExtension</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">var</span></span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>ContentLength64 <span class="token operator">=</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">int</span></span> read<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>read <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>OutputStream<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span></code></pre></div>
<p>Don’t forget in all cases to <strong>close the Output Stream</strong>. In the case of using a StreamWriter, it’s disposal will close the underlying stream, in the case of serving the file directly, you’ll need to do it yourself.</p>
<p>To make things a bit more comfortable for e.g. a browser, it is useful to provide an appropriate MIME type. This is pretty boring code and goes along the lines of this example. A fairly nice list <a href="http://www.feedforall.com/mime-types.htm">can be found here</a>:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">getcontentType</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> extension<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>extension<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">".avi"</span><span class="token punctuation">:</span>  <span class="token keyword">return</span> <span class="token string">"video/x-msvideo"</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">".css"</span><span class="token punctuation">:</span>  <span class="token keyword">return</span> <span class="token string">"text/css"</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span></code></pre></div>
<p>And for those who want to play with this, here’s the full monty:</p>
<p><div id="gist369432" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-httpfileserver-cs" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="file-httpfileserver-cs-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-httpfileserver-cs-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">using</span> <span class="pl-en">System</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-httpfileserver-cs-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-k">using</span> <span class="pl-en">System</span>.<span class="pl-en">IO</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-httpfileserver-cs-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-k">using</span> <span class="pl-en">System</span>.<span class="pl-en">Net</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-httpfileserver-cs-LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-k">using</span> <span class="pl-en">System</span>.<span class="pl-en">Text</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-httpfileserver-cs-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-k">using</span> <span class="pl-en">System</span>.<span class="pl-en">Web</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-httpfileserver-cs-LC6" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-httpfileserver-cs-LC7" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">HttpFileServer</span> : <span class="pl-en">IDisposable</span></td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-httpfileserver-cs-LC8" class="blob-code blob-code-inner js-file-line">  {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-httpfileserver-cs-LC9" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">readonly</span> <span class="pl-k">string</span> <span class="pl-smi">rootPath</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-httpfileserver-cs-LC10" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">const</span> <span class="pl-k">int</span> <span class="pl-smi">bufferSize</span> <span class="pl-k">=</span> <span class="pl-c1">1024</span><span class="pl-k">*</span><span class="pl-c1">512</span>; <span class="pl-c"><span class="pl-c">//</span>512KB</span></td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-httpfileserver-cs-LC11" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">readonly</span> <span class="pl-en">HttpListener</span> <span class="pl-smi">http</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-httpfileserver-cs-LC12" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-httpfileserver-cs-LC13" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">public</span> <span class="pl-en">HttpFileServer</span>(<span class="pl-k">string</span> <span class="pl-smi">rootPath</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-httpfileserver-cs-LC14" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-httpfileserver-cs-LC15" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">this</span>.<span class="pl-smi">rootPath</span> <span class="pl-k">=</span> <span class="pl-smi">rootPath</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-httpfileserver-cs-LC16" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">http</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">HttpListener</span>();</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-httpfileserver-cs-LC17" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">http</span>.<span class="pl-smi">Prefixes</span>.<span class="pl-en">Add</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>http://localhost:8889/<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-httpfileserver-cs-LC18" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">http</span>.<span class="pl-en">Start</span>();</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-httpfileserver-cs-LC19" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">http</span>.<span class="pl-en">BeginGetContext</span>(<span class="pl-smi">requestWait</span>, <span class="pl-c1">null</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-httpfileserver-cs-LC20" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-httpfileserver-cs-LC21" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-httpfileserver-cs-LC22" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">Dispose</span>()</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-httpfileserver-cs-LC23" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-httpfileserver-cs-LC24" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">http</span>.<span class="pl-en">Stop</span>();</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-httpfileserver-cs-LC25" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-httpfileserver-cs-LC26" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-httpfileserver-cs-LC27" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">void</span> <span class="pl-en">requestWait</span>(<span class="pl-en">IAsyncResult</span> <span class="pl-smi">ar</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-httpfileserver-cs-LC28" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-httpfileserver-cs-LC29" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">http</span>.<span class="pl-smi">IsListening</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-httpfileserver-cs-LC30" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-httpfileserver-cs-LC31" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">var</span> <span class="pl-smi">c</span> <span class="pl-k">=</span> <span class="pl-smi">http</span>.<span class="pl-en">EndGetContext</span>(<span class="pl-smi">ar</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-httpfileserver-cs-LC32" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">http</span>.<span class="pl-en">BeginGetContext</span>(<span class="pl-smi">requestWait</span>, <span class="pl-c1">null</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-httpfileserver-cs-LC33" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-httpfileserver-cs-LC34" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">var</span> <span class="pl-smi">url</span> <span class="pl-k">=</span> <span class="pl-en">tuneUrl</span>(<span class="pl-smi">c</span>.<span class="pl-smi">Request</span>.<span class="pl-smi">RawUrl</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-httpfileserver-cs-LC35" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-httpfileserver-cs-LC36" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">var</span> <span class="pl-smi">fullPath</span> <span class="pl-k">=</span> <span class="pl-smi">string</span>.<span class="pl-en">IsNullOrEmpty</span>(<span class="pl-smi">url</span>) <span class="pl-k">?</span> <span class="pl-smi">rootPath</span> <span class="pl-k">:</span> <span class="pl-smi">Path</span>.<span class="pl-en">Combine</span>(<span class="pl-smi">rootPath</span>, <span class="pl-smi">url</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-httpfileserver-cs-LC37" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-httpfileserver-cs-LC38" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">if</span> (<span class="pl-smi">Directory</span>.<span class="pl-en">Exists</span>(<span class="pl-smi">fullPath</span>))</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-httpfileserver-cs-LC39" class="blob-code blob-code-inner js-file-line">        <span class="pl-en">returnDirContents</span>(<span class="pl-smi">c</span>, <span class="pl-smi">fullPath</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-httpfileserver-cs-LC40" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">else</span> <span class="pl-k">if</span> (<span class="pl-smi">File</span>.<span class="pl-en">Exists</span>(<span class="pl-smi">fullPath</span>))</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-httpfileserver-cs-LC41" class="blob-code blob-code-inner js-file-line">        <span class="pl-en">returnFile</span>(<span class="pl-smi">c</span>, <span class="pl-smi">fullPath</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-httpfileserver-cs-LC42" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">else</span> </td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-httpfileserver-cs-LC43" class="blob-code blob-code-inner js-file-line">        <span class="pl-en">return404</span>(<span class="pl-smi">c</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-httpfileserver-cs-LC44" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-httpfileserver-cs-LC45" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-httpfileserver-cs-LC46" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">void</span> <span class="pl-en">returnDirContents</span>(<span class="pl-en">HttpListenerContext</span> <span class="pl-smi">context</span>, <span class="pl-k">string</span> <span class="pl-smi">dirPath</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-httpfileserver-cs-LC47" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-httpfileserver-cs-LC48" class="blob-code blob-code-inner js-file-line">      </td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-httpfileserver-cs-LC49" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">ContentType</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>text/html<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-httpfileserver-cs-LC50" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">ContentEncoding</span> <span class="pl-k">=</span> <span class="pl-smi">Encoding</span>.<span class="pl-smi">UTF8</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-httpfileserver-cs-LC51" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-smi">sw</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">StreamWriter</span>(<span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">OutputStream</span>))</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-httpfileserver-cs-LC52" class="blob-code blob-code-inner js-file-line">      {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-httpfileserver-cs-LC53" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">sw</span>.<span class="pl-en">WriteLine</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>&lt;html&gt;<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-httpfileserver-cs-LC54" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">sw</span>.<span class="pl-en">WriteLine</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>&lt;head&gt;&lt;meta http-equiv=<span class="pl-cce">\&quot;</span>Content-Type<span class="pl-cce">\&quot;</span> content=<span class="pl-cce">\&quot;</span>text/html; charset=utf-8<span class="pl-cce">\&quot;</span>&gt;&lt;/head&gt;<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-httpfileserver-cs-LC55" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">sw</span>.<span class="pl-en">WriteLine</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>&lt;body&gt;&lt;ul&gt;<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-httpfileserver-cs-LC56" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-httpfileserver-cs-LC57" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">var</span> <span class="pl-smi">dirs</span> <span class="pl-k">=</span> <span class="pl-smi">Directory</span>.<span class="pl-en">GetDirectories</span>(<span class="pl-smi">dirPath</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-httpfileserver-cs-LC58" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">foreach</span> (<span class="pl-k">var</span> <span class="pl-smi">d</span> <span class="pl-k">in</span> <span class="pl-smi">dirs</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-httpfileserver-cs-LC59" class="blob-code blob-code-inner js-file-line">        {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-httpfileserver-cs-LC60" class="blob-code blob-code-inner js-file-line">          <span class="pl-k">var</span> <span class="pl-smi">link</span> <span class="pl-k">=</span> <span class="pl-smi">d</span>.<span class="pl-en">Replace</span>(<span class="pl-smi">rootPath</span>, <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-pds">&quot;</span></span>).<span class="pl-en">Replace</span>(<span class="pl-s">&#39;<span class="pl-cce">\\</span>&#39;</span>, <span class="pl-s">&#39;/&#39;</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-httpfileserver-cs-LC61" class="blob-code blob-code-inner js-file-line">          <span class="pl-smi">sw</span>.<span class="pl-en">WriteLine</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>&lt;li&gt;&amp;lt;DIR&amp;gt; &lt;a href=<span class="pl-cce">\&quot;</span><span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> <span class="pl-smi">link</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-cce">\&quot;</span>&gt;<span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> <span class="pl-smi">Path</span>.<span class="pl-en">GetFileName</span>(<span class="pl-smi">d</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&quot;</span>&lt;/a&gt;&lt;/li&gt;<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-httpfileserver-cs-LC62" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-httpfileserver-cs-LC63" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-httpfileserver-cs-LC64" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">var</span> <span class="pl-smi">files</span> <span class="pl-k">=</span> <span class="pl-smi">Directory</span>.<span class="pl-en">GetFiles</span>(<span class="pl-smi">dirPath</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-httpfileserver-cs-LC65" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">foreach</span> (<span class="pl-k">var</span> <span class="pl-smi">f</span> <span class="pl-k">in</span> <span class="pl-smi">files</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-httpfileserver-cs-LC66" class="blob-code blob-code-inner js-file-line">        {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-httpfileserver-cs-LC67" class="blob-code blob-code-inner js-file-line">          <span class="pl-k">var</span> <span class="pl-smi">link</span> <span class="pl-k">=</span> <span class="pl-smi">f</span>.<span class="pl-en">Replace</span>(<span class="pl-smi">rootPath</span>, <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-pds">&quot;</span></span>).<span class="pl-en">Replace</span>(<span class="pl-s">&#39;<span class="pl-cce">\\</span>&#39;</span>, <span class="pl-s">&#39;/&#39;</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-httpfileserver-cs-LC68" class="blob-code blob-code-inner js-file-line">          <span class="pl-smi">sw</span>.<span class="pl-en">WriteLine</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>&lt;li&gt;&lt;a href=<span class="pl-cce">\&quot;</span><span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> <span class="pl-smi">link</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-cce">\&quot;</span>&gt;<span class="pl-pds">&quot;</span></span> <span class="pl-k">+</span> <span class="pl-smi">Path</span>.<span class="pl-en">GetFileName</span>(<span class="pl-smi">f</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&quot;</span>&lt;/a&gt;&lt;/li&gt;<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-httpfileserver-cs-LC69" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-httpfileserver-cs-LC70" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-httpfileserver-cs-LC71" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">sw</span>.<span class="pl-en">WriteLine</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>&lt;/ul&gt;&lt;/body&gt;&lt;/html&gt;<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-httpfileserver-cs-LC72" class="blob-code blob-code-inner js-file-line">      }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-httpfileserver-cs-LC73" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">OutputStream</span>.<span class="pl-en">Close</span>();</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-httpfileserver-cs-LC74" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-httpfileserver-cs-LC75" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-httpfileserver-cs-LC76" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">returnFile</span>(<span class="pl-en">HttpListenerContext</span> <span class="pl-smi">context</span>, <span class="pl-k">string</span> <span class="pl-smi">filePath</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-httpfileserver-cs-LC77" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-httpfileserver-cs-LC78" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">ContentType</span> <span class="pl-k">=</span> <span class="pl-en">getcontentType</span>(<span class="pl-smi">Path</span>.<span class="pl-en">GetExtension</span>(<span class="pl-smi">filePath</span>));</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-httpfileserver-cs-LC79" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">var</span> <span class="pl-smi">buffer</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">byte</span>[<span class="pl-smi">bufferSize</span>];</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-httpfileserver-cs-LC80" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">using</span> ( <span class="pl-k">var</span> <span class="pl-smi">fs</span> <span class="pl-k">=</span> <span class="pl-smi">File</span>.<span class="pl-en">OpenRead</span>(<span class="pl-smi">filePath</span>))</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-httpfileserver-cs-LC81" class="blob-code blob-code-inner js-file-line">      {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-httpfileserver-cs-LC82" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">ContentLength64</span> <span class="pl-k">=</span> <span class="pl-smi">fs</span>.<span class="pl-smi">Length</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-httpfileserver-cs-LC83" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">int</span> <span class="pl-smi">read</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-httpfileserver-cs-LC84" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">while</span> ((<span class="pl-smi">read</span> <span class="pl-k">=</span> <span class="pl-smi">fs</span>.<span class="pl-en">Read</span>(<span class="pl-smi">buffer</span>, <span class="pl-c1">0</span>, <span class="pl-smi">buffer</span>.<span class="pl-smi">Length</span>)) <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-httpfileserver-cs-LC85" class="blob-code blob-code-inner js-file-line">          <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">OutputStream</span>.<span class="pl-en">Write</span>(<span class="pl-smi">buffer</span>, <span class="pl-c1">0</span>, <span class="pl-smi">read</span>); </td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-httpfileserver-cs-LC86" class="blob-code blob-code-inner js-file-line">      }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-httpfileserver-cs-LC87" class="blob-code blob-code-inner js-file-line">      </td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-httpfileserver-cs-LC88" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">OutputStream</span>.<span class="pl-en">Close</span>();</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-httpfileserver-cs-LC89" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-httpfileserver-cs-LC90" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-httpfileserver-cs-LC91" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">return404</span>(<span class="pl-en">HttpListenerContext</span> <span class="pl-smi">context</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-httpfileserver-cs-LC92" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-httpfileserver-cs-LC93" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-smi">StatusCode</span> <span class="pl-k">=</span> <span class="pl-c1">404</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-httpfileserver-cs-LC94" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">context</span>.<span class="pl-smi">Response</span>.<span class="pl-en">Close</span>();</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L95" class="blob-num js-line-number" data-line-number="95"></td>
        <td id="file-httpfileserver-cs-LC95" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L96" class="blob-num js-line-number" data-line-number="96"></td>
        <td id="file-httpfileserver-cs-LC96" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L97" class="blob-num js-line-number" data-line-number="97"></td>
        <td id="file-httpfileserver-cs-LC97" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">string</span> <span class="pl-en">tuneUrl</span>(<span class="pl-k">string</span> <span class="pl-smi">url</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L98" class="blob-num js-line-number" data-line-number="98"></td>
        <td id="file-httpfileserver-cs-LC98" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L99" class="blob-num js-line-number" data-line-number="99"></td>
        <td id="file-httpfileserver-cs-LC99" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">url</span> <span class="pl-k">=</span> <span class="pl-smi">url</span>.<span class="pl-en">Replace</span>(<span class="pl-s">&#39;/&#39;</span>, <span class="pl-s">&#39;<span class="pl-cce">\\</span>&#39;</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L100" class="blob-num js-line-number" data-line-number="100"></td>
        <td id="file-httpfileserver-cs-LC100" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">url</span> <span class="pl-k">=</span> <span class="pl-smi">HttpUtility</span>.<span class="pl-en">UrlDecode</span>(<span class="pl-smi">url</span>, <span class="pl-smi">Encoding</span>.<span class="pl-smi">UTF8</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L101" class="blob-num js-line-number" data-line-number="101"></td>
        <td id="file-httpfileserver-cs-LC101" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">url</span> <span class="pl-k">=</span> <span class="pl-smi">url</span>.<span class="pl-en">Substring</span>(<span class="pl-c1">1</span>);</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L102" class="blob-num js-line-number" data-line-number="102"></td>
        <td id="file-httpfileserver-cs-LC102" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">return</span> <span class="pl-smi">url</span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L103" class="blob-num js-line-number" data-line-number="103"></td>
        <td id="file-httpfileserver-cs-LC103" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L104" class="blob-num js-line-number" data-line-number="104"></td>
        <td id="file-httpfileserver-cs-LC104" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L105" class="blob-num js-line-number" data-line-number="105"></td>
        <td id="file-httpfileserver-cs-LC105" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">string</span> <span class="pl-en">getcontentType</span>(<span class="pl-k">string</span> <span class="pl-smi">extension</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L106" class="blob-num js-line-number" data-line-number="106"></td>
        <td id="file-httpfileserver-cs-LC106" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L107" class="blob-num js-line-number" data-line-number="107"></td>
        <td id="file-httpfileserver-cs-LC107" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">switch</span> (<span class="pl-smi">extension</span>)</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L108" class="blob-num js-line-number" data-line-number="108"></td>
        <td id="file-httpfileserver-cs-LC108" class="blob-code blob-code-inner js-file-line">      {</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L109" class="blob-num js-line-number" data-line-number="109"></td>
        <td id="file-httpfileserver-cs-LC109" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.avi<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>video/x-msvideo<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L110" class="blob-num js-line-number" data-line-number="110"></td>
        <td id="file-httpfileserver-cs-LC110" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.css<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>text/css<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L111" class="blob-num js-line-number" data-line-number="111"></td>
        <td id="file-httpfileserver-cs-LC111" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.doc<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>application/msword<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L112" class="blob-num js-line-number" data-line-number="112"></td>
        <td id="file-httpfileserver-cs-LC112" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.gif<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>image/gif<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L113" class="blob-num js-line-number" data-line-number="113"></td>
        <td id="file-httpfileserver-cs-LC113" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.htm<span class="pl-pds">&quot;</span></span>:</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L114" class="blob-num js-line-number" data-line-number="114"></td>
        <td id="file-httpfileserver-cs-LC114" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.html<span class="pl-pds">&quot;</span></span>: <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>text/html<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L115" class="blob-num js-line-number" data-line-number="115"></td>
        <td id="file-httpfileserver-cs-LC115" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.jpg<span class="pl-pds">&quot;</span></span>:</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L116" class="blob-num js-line-number" data-line-number="116"></td>
        <td id="file-httpfileserver-cs-LC116" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.jpeg<span class="pl-pds">&quot;</span></span>: <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>image/jpeg<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L117" class="blob-num js-line-number" data-line-number="117"></td>
        <td id="file-httpfileserver-cs-LC117" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.js<span class="pl-pds">&quot;</span></span>:   <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>application/x-javascript<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L118" class="blob-num js-line-number" data-line-number="118"></td>
        <td id="file-httpfileserver-cs-LC118" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.mp3<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>audio/mpeg<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L119" class="blob-num js-line-number" data-line-number="119"></td>
        <td id="file-httpfileserver-cs-LC119" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.png<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>image/png<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L120" class="blob-num js-line-number" data-line-number="120"></td>
        <td id="file-httpfileserver-cs-LC120" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.pdf<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>application/pdf<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L121" class="blob-num js-line-number" data-line-number="121"></td>
        <td id="file-httpfileserver-cs-LC121" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.ppt<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>application/vnd.ms-powerpoint<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L122" class="blob-num js-line-number" data-line-number="122"></td>
        <td id="file-httpfileserver-cs-LC122" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.zip<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>application/zip<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L123" class="blob-num js-line-number" data-line-number="123"></td>
        <td id="file-httpfileserver-cs-LC123" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">&quot;</span>.txt<span class="pl-pds">&quot;</span></span>:  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>text/plain<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L124" class="blob-num js-line-number" data-line-number="124"></td>
        <td id="file-httpfileserver-cs-LC124" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">default</span>:      <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">&quot;</span>application/octet-stream<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L125" class="blob-num js-line-number" data-line-number="125"></td>
        <td id="file-httpfileserver-cs-LC125" class="blob-code blob-code-inner js-file-line">      }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L126" class="blob-num js-line-number" data-line-number="126"></td>
        <td id="file-httpfileserver-cs-LC126" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-httpfileserver-cs-L127" class="blob-num js-line-number" data-line-number="127"></td>
        <td id="file-httpfileserver-cs-LC127" class="blob-code blob-code-inner js-file-line">  }</td>
      </tr>
</table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/flq/369432/raw/dba2677884f73c35c7220201f75b5dac4c747435/HttpFileServer.cs" style="float:right">view raw</a>
        <a href="https://gist.github.com/flq/369432#file-httpfileserver-cs">HttpFileServer.cs</a>
        hosted with &#10084; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div></p></div><h2>Previous &amp; Next</h2><div class="blog-post__pagination"><a class="blog-post__pagination--previous" href="/2010/03/23/some-powershell-foo-playin-with-da-task-scheduler">Some PowerShell Foo...playin&#x27; with da Task Scheduler</a><a class="blog-post__pagination--next" href="/2010/05/08/visual-studio-2010-introducing-new-pitfalls">Visual Studio 2010: Introducing new pitfalls</a></div><h2>Comments</h2><div class="blog-post__footer"><div id="disqus_thread"></div></div></article></div></div><div class="row"><div class="footer__twitter"><a href="https://twitter.com/fquednau?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-show-count="false" data-show-screen-name="false">Follow @fquednau</a> </div><p class="footer__copyright">© Frank Quednau <!-- -->2020</p></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  window.excludeGAPaths=[/^(?:\/404)$/];
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-1812710-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2010/04/17/a-http-file-server-in-130-lines-of-code";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-3752ccab0f3df047c847.js"],"component---src-pages-404-js":["/component---src-pages-404-js-28503b239a43329520b3.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b3f7d63e43bb68c468d5.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-fe5d28a675e04ae0a358.js"],"component---src-templates-article-template-js":["/component---src-templates-article-template-js-155164aabab8a9f96f3c.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-b64488dd4664fd68f34a.js"]};/*]]>*/</script><script src="/component---src-templates-article-template-js-155164aabab8a9f96f3c.js" async=""></script><script src="/commons-1786a38fae20bdbb3746.js" async=""></script><script src="/styles-9b6f388623a2ec93d35f.js" async=""></script><script src="/app-3752ccab0f3df047c847.js" async=""></script><script src="/framework-75da9754c2a76bbaf08a.js" async=""></script><script src="/webpack-runtime-5eb18f8be6b26214072d.js" async=""></script></body></html>