<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/app.a03716562d1e590f30ef.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{position:relative;margin:.5em 0;overflow:visible;padding:0}pre[class*=language-]>code{position:relative;border-left:10px solid #358ccb;box-shadow:-1px 0 0 0 #358ccb,0 0 0 1px #dfdfdf;background-color:#fdfdfd;background-image:linear-gradient(transparent 50%,rgba(69,142,209,.04) 0);background-size:3em 3em;background-origin:content-box;background-attachment:local}code[class*=language]{max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdfdfd;box-sizing:border-box;margin-bottom:1em}:not(pre)>code[class*=language-]{position:relative;padding:.2em;border-radius:.3em;color:#c92c2c;border:1px solid rgba(0,0,0,.1);display:inline;white-space:normal}pre[class*=language-]:after,pre[class*=language-]:before{content:"";z-index:-2;display:block;position:absolute;bottom:.75em;left:.18em;width:40%;height:20%;max-height:13em;box-shadow:0 13px 8px #979797;-webkit-transform:rotate(-2deg);transform:rotate(-2deg)}:not(pre)>code[class*=language-]:after,pre[class*=language-]:after{right:.75em;left:auto;-webkit-transform:rotate(2deg);transform:rotate(2deg)}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#7d8b99}.token.punctuation{color:#5f6364}.token.boolean,.token.constant,.token.deleted,.token.function-name,.token.number,.token.property,.token.symbol,.token.tag{color:#c92c2c}.token.attr-name,.token.builtin,.token.char,.token.function,.token.inserted,.token.selector,.token.string{color:#2f9c0a}.token.entity,.token.operator,.token.url,.token.variable{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.class-name,.token.keyword{color:#1990b8}.token.important,.token.regex{color:#e90}.language-css .token.string,.style .token.string{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.important{font-weight:400}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.namespace{opacity:.7}@media screen and (max-width:767px){pre[class*=language-]:after,pre[class*=language-]:before{bottom:14px;box-shadow:none}}.token.cr:before,.token.lf:before,.token.tab:not(:empty):before{color:#e0d7d1}pre[class*=language-].line-numbers.line-numbers{padding-left:0}pre[class*=language-].line-numbers.line-numbers code{padding-left:3.8em}pre[class*=language-].line-numbers.line-numbers .line-numbers-rows{left:0}pre[class*=language-][data-line]{padding-top:0;padding-bottom:0;padding-left:0}pre[data-line] code{position:relative;padding-left:4em}pre .line-highlight{margin-top:0}</style><style data-href="/0.63a74e6388b867dbfc03.css">/*! normalize.css v3.0.2 | MIT License | git.io/normalize */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.container{position:relative;max-width:1260px;margin:0 auto;padding:0 20px}.column,.columns,.container{width:100%;box-sizing:border-box}.column,.columns{float:left}@media (min-width:400px){.container{width:85%;padding:0}}@media (min-width:550px){.container{width:80%}.column,.columns{margin-left:4%}.column:first-child,.columns:first-child{margin-left:0}.one.column,.one.columns{width:4.66666666667%}.two.columns{width:13.3333333333%}.three.columns{width:22%}.four.columns{width:30.6666666667%}.five.columns{width:39.3333333333%}.six.columns{width:48%}.seven.columns{width:56.6666666667%}.eight.columns{width:65.3333333333%}.nine.columns{width:74%}.ten.columns{width:82.6666666667%}.eleven.columns{width:91.3333333333%}.twelve.columns{width:100%;margin-left:0}.one-third.column{width:30.6666666667%}.two-thirds.column{width:65.3333333333%}.one-half.column{width:48%}.offset-by-one.column,.offset-by-one.columns{margin-left:8.66666666667%}.offset-by-two.column,.offset-by-two.columns{margin-left:17.3333333333%}.offset-by-three.column,.offset-by-three.columns{margin-left:26%}.offset-by-four.column,.offset-by-four.columns{margin-left:34.6666666667%}.offset-by-five.column,.offset-by-five.columns{margin-left:43.3333333333%}.offset-by-six.column,.offset-by-six.columns{margin-left:52%}.offset-by-seven.column,.offset-by-seven.columns{margin-left:60.6666666667%}.offset-by-eight.column,.offset-by-eight.columns{margin-left:69.3333333333%}.offset-by-nine.column,.offset-by-nine.columns{margin-left:78%}.offset-by-ten.column,.offset-by-ten.columns{margin-left:86.6666666667%}.offset-by-eleven.column,.offset-by-eleven.columns{margin-left:95.3333333333%}.offset-by-one-third.column,.offset-by-one-third.columns{margin-left:34.6666666667%}.offset-by-two-thirds.column,.offset-by-two-thirds.columns{margin-left:69.3333333333%}.offset-by-one-half.column,.offset-by-one-half.columns{margin-left:52%}}html{font-size:62.5%}body{font-size:1.5em;line-height:1.6;font-weight:400;font-family:Raleway,HelveticaNeue,Helvetica Neue,Helvetica,Arial,sans-serif;color:#222}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:2rem;font-weight:300}h1{font-size:4rem;line-height:1.2}h1,h2{letter-spacing:-.1rem}h2{font-size:3.6rem;line-height:1.25}h3{font-size:3rem;line-height:1.3;letter-spacing:-.1rem}h4{font-size:2.4rem;line-height:1.35;letter-spacing:-.08rem}h5{font-size:1.8rem;line-height:1.5;letter-spacing:-.05rem}h6{font-size:1.5rem;line-height:1.6;letter-spacing:0}@media (min-width:550px){h1{font-size:5rem}h2{font-size:4.2rem}h3{font-size:3.6rem}h4{font-size:3rem}h5{font-size:2.4rem}h6{font-size:1.5rem}}p{margin-top:0}a{color:#1eaedb}a:hover{color:#0fa0ce}.button,button,input[type=button],input[type=reset],input[type=submit]{display:inline-block;height:38px;padding:0 30px;color:#555;text-align:center;font-size:11px;font-weight:600;line-height:38px;letter-spacing:.1rem;text-transform:uppercase;text-decoration:none;white-space:nowrap;background-color:transparent;border-radius:4px;border:1px solid #bbb;cursor:pointer;box-sizing:border-box}.button:focus,.button:hover,button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{color:#333;border-color:#888;outline:0}.button.button-primary,button.button-primary,input[type=button].button-primary,input[type=reset].button-primary,input[type=submit].button-primary{color:#fff;background-color:#33c3f0;border-color:#33c3f0}.button.button-primary:focus,.button.button-primary:hover,button.button-primary:focus,button.button-primary:hover,input[type=button].button-primary:focus,input[type=button].button-primary:hover,input[type=reset].button-primary:focus,input[type=reset].button-primary:hover,input[type=submit].button-primary:focus,input[type=submit].button-primary:hover{color:#fff;background-color:#1eaedb;border-color:#1eaedb}input[type=email],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url],select,textarea{height:38px;padding:6px 10px;background-color:#fff;border:1px solid #d1d1d1;border-radius:4px;box-shadow:none;box-sizing:border-box}input[type=email],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url],textarea{-webkit-appearance:none;-moz-appearance:none;appearance:none}textarea{min-height:65px;padding-top:6px;padding-bottom:6px}input[type=email]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=url]:focus,select:focus,textarea:focus{border:1px solid #33c3f0;outline:0}label,legend{display:block;margin-bottom:.5rem;font-weight:600}fieldset{padding:0;border-width:0}input[type=checkbox],input[type=radio]{display:inline}label>.label-body{display:inline-block;margin-left:.5rem;font-weight:400}ul{list-style:circle inside}ol{list-style:decimal inside}ol,ul{padding-left:0;margin-top:0}ol ol,ol ul,ul ol,ul ul{margin:1.5rem 0 1.5rem 3rem;font-size:90%}li{margin-bottom:1rem}div.highlight{font-size:90%;white-space:nowrap;background:#f1f1f1;border:1px solid #e1e1e1;border-radius:4px;margin-bottom:2.5rem}code{padding:.2rem .5rem;margin:0 .2rem}pre>code{display:block;padding:1rem 1.5rem;white-space:pre}td,th{padding:12px 15px;text-align:left;border-bottom:1px solid #e1e1e1}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}.button,button{margin-bottom:1rem}fieldset,input,select,textarea{margin-bottom:1.5rem}blockquote,dl,figure,form,ol,p,pre,table,ul{margin-bottom:2.5rem}.u-full-width{width:100%;box-sizing:border-box}.u-max-full-width{max-width:100%;box-sizing:border-box}.u-pull-right{float:right}.u-pull-left{float:left}hr{margin-top:3rem;margin-bottom:3.5rem;border-width:0;border-top:1px solid #e1e1e1}.container:after,.row:after,.u-cf{content:"";display:table;clear:both}.highlight .hll{background-color:#ffc}.highlight .c{color:#999}.highlight .err{color:#a00;background-color:#faa}.highlight .k{color:#069}.highlight .o{color:#555}.highlight .cm{color:#09f;font-style:italic}.highlight .cp{color:#099}.highlight .c1,.highlight .cs{color:#999}.highlight .gd{background-color:#fcc;border:1px solid #c00}.highlight .ge{font-style:italic}.highlight .gr{color:red}.highlight .gh{color:#030}.highlight .gi{background-color:#cfc;border:1px solid #0c0}.highlight .go{color:#aaa}.highlight .gp{color:#009}.highlight .gu{color:#030}.highlight .gt{color:#9c6}.highlight .kc,.highlight .kd,.highlight .kn,.highlight .kp,.highlight .kr{color:#069}.highlight .kt{color:#078}.highlight .m{color:#f60}.highlight .s{color:#d44950}.highlight .na{color:#4f9fcf}.highlight .nb{color:#366}.highlight .nc{color:#0a8}.highlight .no{color:#360}.highlight .nd{color:#99f}.highlight .ni{color:#999}.highlight .ne{color:#c00}.highlight .nf{color:#c0f}.highlight .nl{color:#99f}.highlight .nn{color:#0cf}.highlight .nt{color:#2f6f9f}.highlight .nv{color:#033}.highlight .ow{color:#000}.highlight .w{color:#bbb}.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:#f60}.highlight .sb,.highlight .sc{color:#c30}.highlight .sd{color:#c30;font-style:italic}.highlight .s2,.highlight .se,.highlight .sh{color:#c30}.highlight .si{color:#a00}.highlight .sx{color:#c30}.highlight .sr{color:#3aa}.highlight .s1{color:#c30}.highlight .ss{color:#fc3}.highlight .bp{color:#366}.highlight .vc,.highlight .vg,.highlight .vi{color:#033}.highlight .il{color:#f60}.css .nt+.nt,.css .o,.css .o+.nt{color:#999}body{font-size:1.8em}h2,h4{font-size:2.6rem}@media (min-width:550px){h2,h4{font-size:2.7rem}}kbd{padding:.1em;border-radius:3px;border:1px solid #ccc;color:#333;display:inline-block;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 2px #fff;background-color:#f7f7f7;text-shadow:0 1px 0 #fff}figcaption{text-align:center;font-style:italic;color:#777;display:block;margin-bottom:2em}.sidebar h1{font-size:2.4em}.sidebar__sitetitle{color:#af0000}.sidebar__twitter{display:none;margin-top:2rem}.footer__twitter{display:none}.footer__copyright{float:right;font-size:.7em}.right-padded{padding-right:2rem}@media (max-width:550px){.sidebar h1,.sidebar p{margin-bottom:.5rem}.sidebar{padding-bottom:1rem;margin-bottom:1rem;border-bottom:1px solid grey}.footer__twitter{display:inline-block}}@media (min-width:550px){.sidebar h1{-webkit-transform:rotate(-90deg);transform:rotate(-90deg);text-align:right;margin-top:150px;margin-bottom:100px}.sidebar__twitter{display:block}.copyright{margin-top:40px}}.sidebar p{text-align:justify;font-size:.8em}.sidebar h1 a{text-decoration:none}nav a{display:block}.pagination{margin-top:20px}.center,.pagination{text-align:center}.expand{width:80%}.teaser{margin-bottom:70px}.teaser .date{display:block;margin-top:-20px;margin-bottom:20px;text-align:right}.teaser h3 a{text-decoration:none}.page-info{text-align:right;margin-bottom:40px}article iframe,article img{display:block;margin:20px auto;max-width:100%}article div.highlight,article iframe,article img{box-shadow:0 8px 16px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)}article div.highlight{scroll-behavior:auto}blockquote{background:#f9f9f9;border-left:10px solid #ccc;padding:.5em 10px;quotes:"\201C""\201D""\2018""\2019"}blockquote:before{color:#ccc;content:"\201D";font-size:4em;font-family:helvetica;line-height:.1em;margin-right:.25em;vertical-align:-.4em}div.seriestoc{background:#f9f9f9;border-left:10px solid #ccc;padding:.5em 10px;font-size:1em}div.seriestoc:before{color:#ccc;content:":";font-size:4em;font-family:helvetica;line-height:.1em;margin-right:.25em;vertical-align:-.4em}.blog-post__content>h3:first-of-type{text-align:right;border-radius:25px 25px 0 0;font-size:1.2em;background-color:#777;color:#fff;margin-bottom:0;padding:2px 20px 2px 0;font-style:italic}.blog-post__content>ol:first-of-type{list-style-type:upper-roman;background:#eff;border:1px solid #777;border-radius:0 0 25px 25px;margin-top:0;list-style-position:outside;padding:10px 10px 10px 45px}.blog-post__footer{margin:1rem 0 2rem}.article-tags{margin-left:.3rem}.article-tags--tag{margin-left:.5rem}.article-tags--tag:after{margin-left:.5rem;content:"|"}.article-tags--tag:last-child:after{content:""}.blog-post__pagination{display:flex;justify-content:space-between;margin-bottom:2rem}.blog-post__pagination--previous{text-decoration:none;margin:0 1rem}.blog-post__pagination--previous:hover{text-decoration:underline}.blog-post__pagination--previous:before{content:"\21A4   "}.blog-post__pagination--next:after{content:" \21A6"}.blog-post__pagination--next{text-decoration:none;margin:0 1rem}.blog-post__pagination--next:hover{text-decoration:underline}code.language-text{position:relative;padding:0;border-radius:.1em;margin-left:.2em;margin-right:.2em;color:#a55;border-bottom:1px solid rgba(200,100,100,.1);display:inline;white-space:normal}</style><meta name="generator" content="Gatsby 2.0.91"/><title data-react-helmet="true">2D or bitemporal Historization: A primer</title><link data-react-helmet="true" href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css"/><meta data-react-helmet="true" name="description" content="Content from Frank Quednau about dev and fields of interest."/><meta data-react-helmet="true" name="keywords" content="software-development, patterns, fsharp, neo4j"/><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-87673c31a5b37b5e6556b63e1081ebbc.css"/><link rel="alternate" type="application/rss+xml" title="Realfiction RSS" href="/atom.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/component---src-templates-article-template-js-0d50b129641477731f1b.js"/><link as="script" rel="preload" href="/0-3fa69c1a4f2a06128c7c.js"/><link as="script" rel="preload" href="/1-b800af6eeb94a4b43009.js"/><link as="script" rel="preload" href="/app-7003a227919f11333437.js"/><link as="script" rel="preload" href="/webpack-runtime-f655ecba416e18cd3382.js"/><link as="fetch" rel="preload" href="/static/d/80/path---2016-12-18-2-d-or-bitemporal-historization-a-primer-23-e-bd0-6cwEJcNhZKZa3EBYlKd3RAFimTM.json" crossOrigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="container"><div class="row"><div class="two columns right-padded"><div class="sidebar"><h1><a class="sidebar__sitetitle" href="/">Realfiction</a></h1><p>Content from Frank Quednau about dev and fields of interest.</p><nav><a href="/tags">Tags</a></nav><div class="sidebar__twitter"><a href="https://twitter.com/fquednau?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-show-count="false" data-show-screen-name="false">Follow @fquednau</a></div></div></div><div class="nine columns"><article><h1>2D or bitemporal Historization: A primer</h1><div class="page-info"><span>December 18, 2016</span> in<span class="article-tags"><a class="article-tags--tag" href="/tags/software-development">software-development</a><a class="article-tags--tag" href="/tags/patterns">patterns</a><a class="article-tags--tag" href="/tags/fsharp">fsharp</a><a class="article-tags--tag" href="/tags/neo4j">neo4j</a></span></div><div class="blog-post__content"><h3>2D Historization series</h3>
<ol>
<li>2D or bitemporal Historization: A primer</li>
<li><a href="/2017/01/27/2d-historization-in-a-graph-database">2D-Historization in a graph database</a></li>
<li><a href="/2017/01/30/simplify-the-bitemporal-neo4j-query-with-a-user-defined-function">Simplify the bitemporal Neo4J query with a user-defined function</a></li>
</ol>
<p>When it comes to <strong>time</strong> &#x26; software systems, there are three major categories:</p>
<h5>A system that needs no notion of time</h5>
<p>A primitive filesystem manages what is contained right now. It does not care about what files you had one month ago, and it certainly wouldn't know what files you'll have in a month.</p>
<h5>A system that contains historical data</h5>
<p>More &#x26; more systems fall into that category. Whenever we interact with software that is interested in us as a <strong>customer</strong> or as a <strong>product</strong>, it will like to keep past information about us, not only to provide us with e.g. our order history, but to identify patterns within our interaction with software.</p>
<h5>A system that allows past and future alterations</h5>
<p>In a number of systems we need to define changes that will be happening in the future, as well as changes that are retrofitted to have happened in the past. Your boss may have decided three weeks ago that you will get more stash starting 2017. This may have already been recorded in the book-keeping software system of your choice. </p>
<p>Sometimes you may be presented with new information about past events and you want to enter it into the system at the specified date. Martin Fowler <a href="http://martinfowler.com/eaaDev/timeNarrative.html">has written about this</a> already. The <em>take away</em> of such systems is that we need to record two times for those system changes that we are interested in. Martin calls this the <strong>recorded</strong> and <strong>actual</strong> time. The <em>recorded</em> time is the time at which the new information enters the system. The <em>actual</em> time is the one that is relevant to the business modeled by the software.</p>
<p>Such a system now allows us to record changes that occur in the future or in the past. The 2-dimensional nature of such a time point also allows us to ask questions like <em>"How did the state look like one month ago?"</em></p>
<p>Let us reason about such 2D-time-modeling or bitemporal history of our domain with code:</p>
<div class="gatsby-highlight" data-language="fsharp"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">type</span> TimePoint<span class="token operator">&lt;</span><span class="token string">'S> = {
    recorded : int;
    actual : int;
    state : '</span>S<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Any state shall be contained with information when this state was recorded as well as when its validity starts. Often the actual state changes will have a granularity of <strong>days</strong>, while changes may occur multiple times in a day, forcing a higher granularity on the recorded field. We'll just use ints for now (think <em>Epoch</em>).</p>
<p>When we make a query as to the state of the system we will need to specify for which point in time we want the answer. Hence, our historical data will only show states alongside their <strong>actual</strong> dates:</p>
<div class="gatsby-highlight" data-language="fsharp"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">type</span> HistoryEntry<span class="token operator">&lt;</span><span class="token string">'S> = {
    time : int;
    state : '</span>S<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> History<span class="token operator">&lt;</span><span class="token string">'S> = HistoryEntry&lt;'</span>S<span class="token operator">></span> list</code></pre></div>
<p>A situation where we successively store changes may look like that:</p>
<div class="gatsby-highlight" data-language="fsharp"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> chain1 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> recorded <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> actual <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> state <span class="token operator">=</span> <span class="token string">"First"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span> recorded <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> actual <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> state <span class="token operator">=</span> <span class="token string">"Second"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span> recorded <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> actual <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> state <span class="token operator">=</span> <span class="token string">"Third"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span></code></pre></div>
<p>Illustrating such data is typically done with 2 axes: </p>
<p><img src="/assets/2DHistory1.png"></p>
<p>The dashed line shows our <em>"projection"</em> of the history, which is drawn below. Also noteworthy is the fact that we define states open-ended. This is because the end of some state may be different depending on the time at which you project your history. If you look at the above example with <code class="language-text">date = 2</code>, State <strong>"Second"</strong> will have indefinite validity, while the shown projections ends it when <strong>"Third"</strong> is introduced. Indeed, the "end" of some state may typically be a business concern rather than something that needs to be forced upon the modeling of bitemporal history</p>
<p>Let's solidify the way we can project History from our states with code. </p>
<ol>
<li>Given a point in time</li>
<li>Go backwards from that point along the recorded axis</li>
<li>Collect all relevant states.</li>
</ol>
<div class="gatsby-highlight" data-language="fsharp"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> recorded <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// the time at which we look at the state</span>
<span class="token keyword">let</span> history <span class="token operator">=</span> 
    chain1
    <span class="token operator">|</span><span class="token operator">></span> List<span class="token punctuation">.</span>sortByDescending <span class="token punctuation">(</span><span class="token keyword">fun</span> tp <span class="token operator">-</span><span class="token operator">></span> tp<span class="token punctuation">.</span>recorded<span class="token punctuation">)</span>
    <span class="token operator">|</span><span class="token operator">></span> List<span class="token punctuation">.</span>skipWhile <span class="token punctuation">(</span><span class="token keyword">fun</span> tp <span class="token operator">-</span><span class="token operator">></span> tp<span class="token punctuation">.</span>recorded <span class="token operator">></span> recorded<span class="token punctuation">)</span>
    <span class="token operator">|</span><span class="token operator">></span> List<span class="token punctuation">.</span>fold foldHistory <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre></div>
<p><code class="language-text">foldHistory</code> collects all those states that need to be considered.</p>
<div class="gatsby-highlight" data-language="fsharp"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> foldHistory<span class="token operator">&lt;</span>'S<span class="token operator">></span> history timePoint <span class="token operator">=</span> 
    <span class="token keyword">let</span> newPoint <span class="token operator">=</span> <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span> time <span class="token operator">=</span> timePoint<span class="token punctuation">.</span>actual<span class="token punctuation">;</span> state <span class="token operator">=</span> timePoint<span class="token punctuation">.</span>state <span class="token punctuation">}</span>
    <span class="token keyword">match</span> history <span class="token keyword">with</span>
    <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token function">newPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span><span class="token punctuation">:</span> history
    <span class="token operator">|</span> historyEntry<span class="token punctuation">:</span><span class="token punctuation">:</span>rest <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">match</span> <span class="token punctuation">(</span>historyEntry<span class="token punctuation">,</span> timePoint<span class="token punctuation">)</span> <span class="token keyword">with</span>
                        <span class="token operator">|</span> MustBeConsidered <span class="token operator">-</span><span class="token operator">></span> <span class="token function">newPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span><span class="token punctuation">:</span> history
                        <span class="token operator">|</span> CanBeIgnored <span class="token operator">-</span><span class="token operator">></span> history</code></pre></div>
<p>Given a certain condition, a new <code class="language-text">HistoryEntry</code> <em>must be considered</em> and will be prepended to the list of already collected history entries. What is that condition? Consider the following state changes:</p>
<div class="gatsby-highlight" data-language="fsharp"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> chain2 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> recorded <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> actual <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> state <span class="token operator">=</span> <span class="token string">"First"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span> recorded <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> actual <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> state <span class="token operator">=</span> <span class="token string">"Second"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span> recorded <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> actual <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> state <span class="token operator">=</span> <span class="token string">"Third"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span></code></pre></div>
<p><img src="/assets/2DHistory2.png"></p>
<p>State <strong>"Second"</strong> is being superseded by a new state. In other words, depending at which point in time you look at the state of the system, State <strong>"First"</strong> is either followed by <strong>"Second"</strong> or <strong>"Third"</strong>.</p>
<p>Hence <em>"Collecting the relevant states"</em> means that while we move backwards along the <strong>recorded</strong> axis, only those states whose <strong>actual</strong> value is smaller than the one of the previously collected state will be considered.</p>
<div class="gatsby-highlight" data-language="fsharp"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token operator">|</span>MustBeConsidered<span class="token operator">|</span>CanBeIgnored<span class="token operator">|</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>reference<span class="token punctuation">,</span> newTime<span class="token punctuation">)</span> <span class="token operator">=</span> 
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newTime<span class="token punctuation">.</span>actual <span class="token operator">&lt;=</span> reference<span class="token punctuation">.</span>time<span class="token punctuation">)</span> <span class="token keyword">then</span> MustBeConsidered <span class="token keyword">else</span> CanBeIgnored</code></pre></div>
<p>Performing such logic in code, in-memory may prohibit itself when some object undergoes hundreds or thousands of changes throughout its lifetime. Having to keep time as a 2-Dimensional record complicates matters a lot in terms of e.g. persistence. </p>
<p>However, the logic behind it is fairly straightforward. </p></div><div class="blog-post__footer"><a href="https://mobile.twitter.com/search?q=https%3A%2F%2Frealfiction.net%2F2016/12/18/2d-or-bitemporal-historization-a-primer" target="_blank" rel="noopener noreferrer">Discuss on Twitter ⇲</a></div><div class="blog-post__pagination"><a class="blog-post__pagination--previous" href="/2016/09/26/how-to-get-started-with-marten-on-osx-hint-theres-nothing-to-it">How to get started with Marten on OSX (Hint: There&#x27;s nothing to it)</a><a class="blog-post__pagination--next" href="/2017/01/03/auxerrois">Auxerrois</a></div></article></div></div><div class="row"><div class="footer__twitter"><a href="https://twitter.com/fquednau?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-show-count="false" data-show-screen-name="false">Follow @fquednau</a> </div><p class="footer__copyright">© Frank Quednau <!-- -->2019</p></div></div></div></div><script>
  window.excludeGAPaths=[/^(?:\/404)$/];
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-1812710-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-article-template-js","jsonName":"2016-12-18-2-d-or-bitemporal-historization-a-primer-23e","path":"/2016/12/18/2d-or-bitemporal-historization-a-primer"};window.dataPath="80/path---2016-12-18-2-d-or-bitemporal-historization-a-primer-23-e-bd0-6cwEJcNhZKZa3EBYlKd3RAFimTM";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.a03716562d1e590f30ef.css","/app-7003a227919f11333437.js"],"component---src-templates-article-template-js":["/component---src-templates-article-template-js-0d50b129641477731f1b.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-827eb0660badd62ebbc1.js"],"component---src-pages-404-js":["/component---src-pages-404-js-7de7581acfdeae5a1ab6.js"],"component---src-pages-index-js":["/component---src-pages-index-js-cc7c87d4d9fb6da3d023.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-bad0e5b91c4d33cf52ba.js"],"pages-manifest":["/pages-manifest-a6cd774493b2e7ddf8dd.js"]};/*]]>*/</script><script src="/webpack-runtime-f655ecba416e18cd3382.js" async=""></script><script src="/app-7003a227919f11333437.js" async=""></script><script src="/1-b800af6eeb94a4b43009.js" async=""></script><script src="/0-3fa69c1a4f2a06128c7c.js" async=""></script><script src="/component---src-templates-article-template-js-0d50b129641477731f1b.js" async=""></script></body></html>