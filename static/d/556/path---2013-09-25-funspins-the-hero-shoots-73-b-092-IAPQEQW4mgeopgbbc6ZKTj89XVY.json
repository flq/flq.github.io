{"data":{"markdownRemark":{"html":"<h2>Functional space-invaders series</h2>\n<ol>\n<li><a href=\"/2013/09/17/FunSpIns-a-recap-of-Rob-Ashtons-lessons-Das-Intro\">A recap of Rob Ashton's lessons - Das Intro</a></li>\n<li><a href=\"/2013/09/18/FunSpIns-Drawing-a-Rectangle\">Drawing a Rectangle</a></li>\n<li><a href=\"/2013/09/19/FunSpIns-Moving-a-Rectangle\">Moving a Rectangle</a></li>\n<li><a href=\"/2013/09/20/FunSpIns-No-attributes-No-vectors-A-tiny-Workflow-and-more-squares\">No attributes, No vectors, A tiny Workflow and more squares</a></li>\n<li><a href=\"/2013/09/23/FunSpIns-State-the-World-the-Loop\">State, the World, the Loop</a></li>\n<li><a href=\"/2013/09/24/FunSpIns-The-hero-must-move-the-enemies-must-move-smarter\">The hero must move, the enemies must move smarter</a></li>\n<li>The hero shoots</li>\n<li><a href=\"/2013/09/26/FunSpIns-Collisions-the-dead-and-a-not-so-grateful-ending\">Collisions, the dead, and a (not so) grateful ending</a></li>\n</ol>\n<blockquote>\n<p>Inspired by Rob Ashton's series \"<a href=\"http://codeofrob.com/entries/learn-functional-programming-with-me---adding-items-to-a-sequence.html\">Learn functional programming with me</a>\"</p>\n</blockquote>\n<p>Before getting down to the additions necessary to get great space defender to shoot, a few refactorings that occurred along the way...</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">data WorldItem = Enemy Point Int | Hero Point | Shot Point\n...\ngetRect (Enemy (x,y) _) = Rect x y 20 10\ngetRect (Hero (x,y)) =  Rect x y 25 15\ngetRect (Shot (x,y)) = Rect x y 5 6\ngetPixel (Enemy _ _) = Pixel 0xFFFFFF\ngetPixel (Hero _) = Pixel 0xFF0000\ngetPixel (Shot _) = Pixel 0xFFFF00</code></pre></div>\n<p>Here, you can see pattern matching in action:  A world item may either be an <strong>enemy</strong>, the <strong>hero</strong> or a <strong>shot</strong>. Based on this information I can now choose different rectangle sizes and different colours for the three different kinds of world items - adding new kinds of world items would be a trivial task. As a mostly OO programmer this does look quite a bit like a visitor pattern, only that this sort of pattern is pretty much first class in Haskell. </p>\n<p>Since I already found an abstraction to actors in this little game world, adding the shooting is a rather straightforward affair.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">shotsActor :: World -&gt; (World,[WorldItem])\nshotsActor w = (newState, (heroShots newState))\n  where\n    newState = case (lastKey w) of\n      SDLK_SPACE -&gt; w { heroShots = (move (heroShots w)) ++ [newShot], lastKey = SDLK_UNKNOWN }\n      _ -&gt; w { heroShots = move (heroShots w) }\n    move = map (\\(Shot (x,y)) -&gt; Shot (x, y-10))\n    newShot = Shot ((+10) $ getX $ heroPosition w,430)</code></pre></div>\n<p>The world data now has an additional property : <strong>heroShots :: [WorldItem]</strong>.\nThe new state is derived from whether the space key was pressed or not. In either case, the shots need to keep moving through the world, with the only difference that when pressing space, another shot is added to the list of existing shots. Finally, the last key value is erased to ensure that pressing space only fires a single shot. </p>\n<blockquote>\n<p>Just now while I am writing this I come to realize that I have no code to delete shots that are not inside the viewport anymore -\nfunny enough I never noticed any detrimental effect on performance while playing and frantically hitting the space key...</p>\n</blockquote>\n<p>While I am leaving the thing as it is, one can see implementation detail leakage in action: Deriving where a shot should appear assumes the size of our defender as well as his position. Nothing that couldn't be rectified, but I can live with that for now. </p>","frontmatter":{"date":"September 25, 2013","path":null,"title":"FunSpIns - The hero shoots.","tags":["software-development","haskell","fun-spin"]}}},"pageContext":{"title":"FunSpIns - The hero shoots."}}