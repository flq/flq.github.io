{"data":{"markdownRemark":{"html":"<p>When you do the MS exams to become a certified developer you may come across the 486 course. The <a href=\"https://channel9.msdn.com/Series/Dev-ASP-MVC4-WebApps\">supporting video</a> for that is 4 years old and is based on MVC 4. This post keep the notes I made while working through the video's content based on ASP.NET Core's capabilities, to see whether the info in there still holds up. The code is <a href=\"https://github.com/flq/MS486Core\">checked in</a>, the commits more or less follow the progress made in the videos on channel 9.</p>\n<!-- START doctoc generated TOC please keep comment here to allow auto update -->\n<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->\n<ul>\n<li><a href=\"#video-1---introduction\">Video 1 - Introduction</a></li>\n<li><a href=\"#video-2---models\">Video 2 - Models</a></li>\n<li><a href=\"#video-3--controllers\">Video 3- Controllers</a></li>\n<li><a href=\"#video-4--views\">Video 4- Views</a></li>\n<li><a href=\"#video-5---javascript-page-updates-etc\">Video 5 - Javascript, Page updates etc.</a></li>\n<li><a href=\"#video-6---web-apis\">Video 6 - Web APIs.</a></li>\n<li>\n<p><a href=\"#deploying-to-azure\">Deploying to Azure</a></p>\n<ul>\n<li><a href=\"#missing-microsoftentityframeworkcoredesign\">Missing <code class=\"language-text\">Microsoft.EntityFrameworkCore.Design</code></a></li>\n<li><a href=\"#connection-string-from-_appsettingsjson_-not-found\">Connection string from <em>appsettings.json</em> not found:</a></li>\n<li><a href=\"#config-object-null\">Config object null</a></li>\n</ul>\n</li>\n</ul>\n<!-- END doctoc generated TOC please keep comment here to allow auto update -->\n<h3>Video 1 - Introduction</h3>\n<p>To get ourselves an mvc app we can do</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet new web\ndotnet add package Microsoft.AspnetCore.Mvc\ndotnet add package Microsoft.AspnetCore.StaticFiles</code></pre></div>\n<p>I deliberately started fom an <em>empty</em> web project, because I am a purist like that. You could also do <code class=\"language-text\">dotnet new mvc</code> and have a ton of stuff and an application that can run. To be honest, what put me off where the bower references. I am not going to start getting aquainted with bower at this point int time.</p>\n<p>Anyhow, you can hook up the MVC functionality yourself into the basic web application startup:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token comment\">//\"ConfigureServices\"</span>\nservices<span class=\"token punctuation\">.</span><span class=\"token function\">AddMvc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token comment\">// \"Configure\"</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">UseStaticFiles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">UseMvc</span><span class=\"token punctuation\">(</span>routes <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n    routes<span class=\"token punctuation\">.</span><span class=\"token function\">MapRoute</span><span class=\"token punctuation\">(</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">,</span>\n        template<span class=\"token punctuation\">:</span> <span class=\"token string\">\"{controller=Home}/{action=Index}/{id?}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<p>Then we need</p>\n<ul>\n<li><strong>Controllers</strong> and <strong>Views</strong> folders</li>\n<li>A <strong>HomeController</strong>, an <strong>Index</strong> view, maybe a <strong>Layout</strong></li>\n</ul>\n<p>and off you go. So far, pretty much the same stuff.</p>\n<h3>Video 2 - Models</h3>\n<p>Entity Framework, really now?\nOh well, I said I would follow along, so here we go:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet add package Microsoft.EntityFrameworkCore.SqlServer</code></pre></div>\n<p>Now we wire up tha database stuff on Startup...</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token comment\">// In \"ConfigureServices\"</span>\nservices<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddDbContext</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConferenceContext</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>opt <span class=\"token operator\">=</span><span class=\"token operator\">></span> opt<span class=\"token punctuation\">.</span><span class=\"token function\">UseSqlServer</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"Server=(localdb)\\\\mssqllocaldb;Database=Conferences;\"</span> <span class=\"token operator\">+</span>\n  <span class=\"token string\">\"Trusted_Connection=True;MultipleActiveResultSets=true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That local db file will btw end up in your user directory (i.e. ~), I was too lazy to parse through changing the default,\nso I stuck with it (With frameworks &#x26; dependencies like that, just go with the flow, you will thank me when you have time\nto go have drinks on the weekend)</p>\n<p>The ConferenceContext is <a href=\"https://github.com/flq/MS486Core/blob/master/Database/ConferenceContext.cs\">over here</a>, then there is some initialization code, <a href=\"https://github.com/flq/MS486Core/blob/master/Database/DbInitializer.cs\">hand-written</a>. I didn't find that\nfancy <strong>DropCreateAlwaysDatabaseInitializer</strong> thing mentioned in the video, but this is about MVC, not EF, so I didn't search very hard. The initializer will do fine, I'm sure. We call it in Startup's <code class=\"language-text\">Configure</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConferenceContext</span> dbContext<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">.</span><span class=\"token function\">IsDevelopment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        app<span class=\"token punctuation\">.</span><span class=\"token function\">UseDeveloperExceptionPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        DbInitializer<span class=\"token punctuation\">.</span><span class=\"token function\">Initialize</span><span class=\"token punctuation\">(</span>dbContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>By configuring the EF stuff into the in-built DI Container, we could just let the framework provide us with a db Context.\nYou will often see in the videos that the context gets instantiated in the controllers. You won't need to do that anymore. If you want to know more about EF on .NET Core, <a href=\"https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/intro\">this page</a> is a good starting point.</p>\n<p>The <code class=\"language-text\">ComponentModel</code> namespace is around, so you can attribute your models like crazy, just like in the video.</p>\n<h3>Video 3- Controllers</h3>\n<p>All still basically the same stuff. There is now also an <code class=\"language-text\">IActionResult</code> interface if you want to implemen the Action Result yourself completely. Also the action / controller filters have more options to choose from...</p>\n<ul>\n<li>Auth filters - user authorisation</li>\n<li>Resource filters - Caching etc.</li>\n<li>Action filters - run code before / after</li>\n<li>Exception filters - as the name implies</li>\n<li>Result filters - only when the wrapped action runs successfully</li>\n</ul>\n<p>There are also async variants, it is all nicely explained <a href=\"https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/filters\">over here</a>.</p>\n<p>Global filters are added in the <strong>Startup</strong> through the options object that you get when calling the corresponding overload of <code class=\"language-text\">services.AddMvc();</code> inside <code class=\"language-text\">ConfigureServices</code>. </p>\n<h3>Video 4- Views</h3>\n<p>Html Helpers are still around, but what you may probably do these days is using the new <a href=\"https://docs.microsoft.com/en-us/aspnet/core/mvc/views/tag-helpers/intro\">Tag Helpers</a> to write out such a form. This is looking somewhat like that:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">asp-action</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Create<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">asp-validation-summary</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>All<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>one column<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">asp-for</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">asp-validation-for</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>eight columns<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">asp-for</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    ...</code></pre></div>\n<p>One of the <a href=\"https://github.com/flq/MS486Core/commit/7591aa5cdf08e2339a508240acc1d0ac8d23b5c2\">last commits</a> introduces some custom layout tag helpers to test out the feature.</p>\n<p><strong>Partial Views</strong> seem more or less unchanged.</p>\n<h3>Video 5 - Javascript, Page updates etc.</h3>\n<p>There has been so much change with regard to how to do &#x26; use javascript for UIs in general and ASP.NET MVC in particular lately that I am not going into much detail here. You can still return partial views, but e.g. the Ajax helper you see in the video does not seem to be around.</p>\n<p>Bundling and minification also seems <a href=\"https://docs.microsoft.com/en-us/aspnet/core/client-side/bundling-and-minification\">to be supported</a> as a build step rather than a runtime step. These days you may do this with a tool like <a href=\"https://webpack.github.io/\">webpack</a> anyway, so there isn't much need to do this via Visual Studio. Also, all that nice javascript out there isn't made available via Nuget anymore but you'll rather have to go to npm. Additionally, jQuery just isn't as important anymore.</p>\n<h3>Video 6 - Web APIs.</h3>\n<p>Quite a few changes over here as well. Web API got folded into the ASP.NET Core effort. Apparently there is a <a href=\"https://stackify.com/asp-net-core-web-api-guide/\">compatibility shim</a> to smooth migration of an existing application. But, if you start from scratch, my repo contains a minimal example of getting all Sessions or Speakers, together with content negotation.</p>\n<p>Out of the box you only get support for json. For xml e.g. you need to </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet add package Microsoft.AspNetCore.Mvc.Formatters.Xml</code></pre></div>\n<p>And then in <code class=\"language-text\">Startup.ConfigureServices</code></p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">services<span class=\"token punctuation\">.</span><span class=\"token function\">AddMvc</span><span class=\"token punctuation\">(</span>opts <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n  opts<span class=\"token punctuation\">.</span>OutputFormatters<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">XmlSerializerOutputFormatter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then, a simple controller which inherits from Controller, just like the MVC ones:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token punctuation\">[</span><span class=\"token class-name\">Route</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"api/[controller]/[action]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DataController</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Controller</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">ConferenceContext</span> _ctx<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token function\">DataController</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConferenceContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> _ctx <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token class-name\">HttpGet</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> IEnumerable<span class=\"token operator\">&lt;</span>Session<span class=\"token operator\">></span> <span class=\"token function\">Sessions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> _ctx<span class=\"token punctuation\">.</span>Sessions<span class=\"token punctuation\">.</span><span class=\"token function\">ToList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token class-name\">HttpGet</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> IEnumerable<span class=\"token operator\">&lt;</span>Speaker<span class=\"token operator\">></span> <span class=\"token function\">Speakers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> _ctx<span class=\"token punctuation\">.</span>Speakers<span class=\"token punctuation\">.</span><span class=\"token function\">ToList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, e.g. with curl you can make calls with the proper accept header:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> localhost:5000/api/data/speakers -v -H <span class=\"token string\">\"Accept: application/xml\"</span></code></pre></div>\n<p>And, presto, api with content negotiation.</p>\n<h3>Deploying to Azure</h3>\n<p>I won't go into the actual azure deploying, as there are so many ways to do it (e.g. deploying a container these days, etc.), but in the\nlight of doing standard MVC apps, one can have a look on how to do Entity Framewrk migrations these days. We will do this in the command line,\nand for this we extend the <code class=\"language-text\">dotnet</code>-CLI by adding a \"plugin\" in the csproj file (don't forget to <code class=\"language-text\">dotnet restore</code> afterwards):</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&lt;!-- stuff --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>DotNetCliToolReference</span> <span class=\"token attr-name\">Include</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Microsoft.EntityFrameworkCore.Tools.DotNet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Version</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>1.0.1<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemGroup</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>When all works you should be able to run migration commands via <code class=\"language-text\">dotnet ef ...</code></p>\n<p>And then, when you are working without Visual Studio you may be subject to a number of issues:</p>\n<h4>Missing <code class=\"language-text\">Microsoft.EntityFrameworkCore.Design</code></h4>\n<p>add it e.g. via <code class=\"language-text\">dotnet add package</code> and restore.</p>\n<h4>Connection string from <em>appsettings.json</em> not found:</h4>\n<p>The migrations thing actually runs from <code class=\"language-text\">bin/...</code>, so you need to make sure that your settings file ends up there as well.</p>\n<p>Doing this manually, you need to add the following to the csproj file:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Content</span> <span class=\"token attr-name\">Update</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>appsettings.json<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CopyToOutputDirectory</span><span class=\"token punctuation\">></span></span>Always<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CopyToOutputDirectory</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Content</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemGroup</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h4>Config object null</h4>\n<p>the migrations tool will actually run your <code class=\"language-text\">ConfigureServices</code> code from your startup, but <strong>NOT</strong> your Program's Main.\nIt is there where I had the code to instantiate a config. To resolve, I check in <code class=\"language-text\">ConfigureServices</code> that the Config object exists:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token comment\">//Startup.cs</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ConfigureServices</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IServiceCollection</span> services<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    Program<span class=\"token punctuation\">.</span><span class=\"token function\">EnsureConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n    services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddDbContext</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConferenceContext</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>opt <span class=\"token operator\">=</span><span class=\"token operator\">></span> \n        opt<span class=\"token punctuation\">.</span><span class=\"token function\">UseSqlServer</span><span class=\"token punctuation\">(</span>\n            Program<span class=\"token punctuation\">.</span>Configuration<span class=\"token punctuation\">.</span><span class=\"token function\">GetConnectionString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DefaultConnection\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Program.cs</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">EnsureConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Configuration <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> builder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConfigurationBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">SetBasePath</span><span class=\"token punctuation\">(</span>Directory<span class=\"token punctuation\">.</span><span class=\"token function\">GetCurrentDirectory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">AddJsonFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"appsettings.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    Configuration <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">Build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>From there on I was able to use the tool. Then we can create the initial setup:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet ef migrations add InitialCreate\ndotnet ef database update</code></pre></div>\n<p>which sets up a migration file (as well as a .designer.cs file? No idea...). Btw, for a documentation of the tool's capabilities go to\nthe <a href=\"https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/migrations\">Migrations docs</a></p>","fields":{"slug":"/2017/07/29/ms-asp-net-mvc-certification-course-vs-asp-net-core"},"frontmatter":{"date":"July 29, 2017","path":null,"title":"MS ASP.NET MVC Certification course vs ASP.NET core","tags":["web","programming","dotnet"]}}},"pageContext":{"title":"MS ASP.NET MVC Certification course vs ASP.NET core","previous":{"fields":{"slug":"/2017/07/28/remorse-the-overall-application-structure"},"frontmatter":{"title":"remorse - the overall application structure","tags":["web","programming","react","javascript"],"date":"2017/07/28"}},"next":{"fields":{"slug":"/2017/08/19/porting-a-react-application-to-elm-starting-with-a-conclusion"},"frontmatter":{"title":"'Porting' a react application to elm - starting with a conclusion","tags":["programming","web","react"],"date":"2017/08/19"}}}}