{"data":{"markdownRemark":{"html":"<p>This post was sparked by a tweet from Ryan Florence...</p>\n<blockquote class=\"twitter-tweet\" data-cards=\"hidden\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">When I think about building a UI like the checkout process for my workshops it&#39;s impossible to imagine doing it without xstate.<br><br>The visualizer helps me write the code w/o any significant bugs or blindspots from the start.<br><br>Great job <a href=\"https://twitter.com/DavidKPiano?ref_src=twsrc%5Etfw\">@DavidKPiano</a> <a href=\"https://t.co/v4zjMtkm15\">https://t.co/v4zjMtkm15</a> <a href=\"https://t.co/RnmOTsAe5X\">pic.twitter.com/RnmOTsAe5X</a></p>&mdash; Ryan Florence (@ryanflorence) <a href=\"https://twitter.com/ryanflorence/status/1084248892072329216?ref_src=twsrc%5Etfw\">January 13, 2019</a></blockquote>\n<p>It has been some <a href=\"/2007/01/22/state-design-pattern-simplified\">quite some time</a> since I last looked at declaratively defining and executing a state machine, so I got curious and visited <a href=\"https://xstate.js.org/docs/guides/start.html\">xstate</a>.</p>\n<p>What you get access to is a library that gives you the ability to declare a state machine with a lot of features. I wanted to recreate the \"tape player\" from my post 12 years ago. COnsidering that xstate brings a lot more to the plate, I wanted the tape player to be a lot more complete than back then. The <a href=\"https://github.com/flq/test-of-xstate\">source code</a> for the final result runs as react app and can be found under my github profile.</p>\n<p>At <a href=\"https://statecharts.github.io/xstate-viz/\">statecharts.github.io</a> it is possible to visualize the state machine that you defined. For the tape player in the source code we get this:</p>\n<p><img src=\"/assets/xstate_visual.png\" alt=\"firefox location bar\"></p>\n<figcaption>And you thought a tape player is easy?</figcaption>\n<p>What you see is the states (the big boxes) and events (the small labels that start arrows) that define your state machine.</p>\n<p>The tape player is initially <em>stopped</em>. The <strong>PLAY</strong> event moves it to <em>playing</em>. Basically you can move from <em>playing</em> to <em>forwarding</em> and back to <em>playing</em>, but if you want to be <em>rewinding</em>, you need to be <em>stopped</em> first.</p>\n<p>You perform transitions by raising events. These events can be typed:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> EventId <span class=\"token operator\">=</span> <span class=\"token string\">\"PLAY\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"STOP\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"FORWARD\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"REWIND\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TapePlayerEvent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">EventObject</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">type</span><span class=\"token punctuation\">:</span> EventId<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then you can define your available states:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TapePlayerStateSchema</span> <span class=\"token punctuation\">{</span>\n  states<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    stopped<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    playing<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    forwarding<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    rewinding<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> AvailableStates <span class=\"token operator\">=</span> keyof TapePlayerStateSchema<span class=\"token punctuation\">[</span><span class=\"token string\">\"states\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>These two types give you a little bit of compile-time safety once you start defining the main configuration object for your state machine:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript \"><pre style=\"counter-reset: linenumber 0\" class=\"language-typescript  line-numbers\"><code class=\"language-typescript \">function machineBuilder(): [\n  MachineConfig&lt;TapePlayerContext, TapePlayerStateSchema, TapePlayerEvent&gt;,\n  any\n] {\n  return [\n    {\n      id: &quot;tape player&quot;,\n      initial: &quot;stopped&quot;,\n      context: {\n        pos: 0\n      },\n      states: {\n        rewinding: {\n          onEntry: [&quot;rewindingEffect&quot;],\n          after: {\n            500: [\n              {\n                target: &quot;rewinding&quot;,\n                cond: ctx =&gt; ctx.pos &gt; 0\n              },\n              {\n                target: &quot;stopped&quot;\n              }\n            ]\n          },\n          on: { STOP: &quot;stopped&quot; }\n        },\n        stopped: {\n          on: {\n            PLAY: { target: &quot;playing&quot; },\n            FORWARD: &quot;forwarding&quot;,\n            REWIND: &quot;rewinding&quot;\n          }\n        },\n        playing: {\n          onEntry: [&quot;playingEffect&quot;],\n          after: {\n            500: [\n              {\n                target: &quot;playing&quot;,\n                cond: ctx =&gt; ctx.pos &lt; 100\n              },\n              {\n                target: &quot;stopped&quot;\n              }\n            ]\n          },\n          on: {\n            FORWARD: &quot;forwarding&quot;,\n            STOP: &quot;stopped&quot;\n          }\n        },\n        forwarding: {\n          onEntry: [&quot;forwardingEffect&quot;],\n          after: {\n            500: [\n              {\n                target: &quot;forwarding&quot;,\n                cond: ctx =&gt; ctx.pos &lt; 100\n              },\n              { target: &quot;stopped&quot; }\n            ]\n          },\n          on: { PLAY: &quot;playing&quot;, STOP: &quot;stopped&quot; }\n        }\n      }\n    },\n    {\n      actions: {\n        playingEffect,\n        forwardingEffect,\n        rewindingEffect\n      }\n    }\n  ];\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<figcaption>OK, that was a mouthful!</figcaption>","fields":{"slug":"/2019/01/30/xstate-a-typescript-state-machine-with-a-lot-of-features"},"frontmatter":{"date":"January 30, 2019","path":null,"title":"XState - a Typescript state machine with a lot of features","tags":["typescript","programming"]}}},"pageContext":{"title":"XState - a Typescript state machine with a lot of features","previous":{"fields":{"slug":"/2019/01/27/im-a-chrome-using-frontend-dev-but-want-to-use-firefox-more"},"frontmatter":{"title":"I'm a Chrome-using frontend dev, but want to use Firefox more","tags":["web","programming"],"date":"2019/01/27"}},"next":null}}