{"data":{"markdownRemark":{"html":"<h3>Functional space-invaders series</h3>\n<ol>\n<li><a href=\"/2013/09/17/funspins-a-recap-of-rob-ashtons-lessons-das-intro\">A recap of Rob Ashton's lessons - Das Intro</a></li>\n<li><a href=\"/2013/09/18/funspins-drawing-a-rectangle\">Drawing a Rectangle</a></li>\n<li><a href=\"/2013/09/19/funspins-moving-a-rectangle\">Moving a Rectangle</a></li>\n<li><a href=\"/2013/09/20/funspins-no-attributes-no-vectors-a-tiny-workflow-and-more-squares\">No attributes, No vectors, A tiny Workflow and more squares</a></li>\n<li><a href=\"/2013/09/23/funspins-state-the-world-the-loop\">State, the World, the Loop</a></li>\n<li><a href=\"/2013/09/24/funspins-the-hero-must-move-the-enemies-must-move-smarter\">The hero must move, the enemies must move smarter</a></li>\n<li>The hero shoots</li>\n<li><a href=\"/2013/09/26/funspins-collisions-the-dead-and-a-not-so-grateful-ending\">Collisions, the dead, and a (not so) grateful ending</a></li>\n</ol>\n<blockquote>\n<p>Inspired by Rob Ashton's series \"<a href=\"http://codeofrob.com/entries/learn-functional-programming-with-me---adding-items-to-a-sequence.html\">Learn functional programming with me</a>\"</p>\n</blockquote>\n<p>Before getting down to the additions necessary to get great space defender to shoot, a few refactorings that occurred along the way...</p>\n<div class=\"gatsby-highlight\" data-language=\"haskell\"><pre class=\"language-haskell\"><code class=\"language-haskell\"><span class=\"token keyword\">data</span> <span class=\"token constant\">WorldItem</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Enemy</span> <span class=\"token constant\">Point</span> <span class=\"token constant\">Int</span> <span class=\"token operator\">|</span> <span class=\"token constant\">Hero</span> <span class=\"token constant\">Point</span> <span class=\"token operator\">|</span> <span class=\"token constant\">Shot</span> <span class=\"token constant\">Point</span>\n<span class=\"token operator\">...</span>\n<span class=\"token hvariable\">getRect</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Enemy</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">x</span><span class=\"token punctuation\">,</span><span class=\"token hvariable\">y</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">_</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Rect</span> <span class=\"token hvariable\">x</span> <span class=\"token hvariable\">y</span> <span class=\"token number\">20</span> <span class=\"token number\">10</span>\n<span class=\"token hvariable\">getRect</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Hero</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">x</span><span class=\"token punctuation\">,</span><span class=\"token hvariable\">y</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span>  <span class=\"token constant\">Rect</span> <span class=\"token hvariable\">x</span> <span class=\"token hvariable\">y</span> <span class=\"token number\">25</span> <span class=\"token number\">15</span>\n<span class=\"token hvariable\">getRect</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Shot</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">x</span><span class=\"token punctuation\">,</span><span class=\"token hvariable\">y</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Rect</span> <span class=\"token hvariable\">x</span> <span class=\"token hvariable\">y</span> <span class=\"token number\">5</span> <span class=\"token number\">6</span>\n<span class=\"token hvariable\">getPixel</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Enemy</span> <span class=\"token hvariable\">_</span> <span class=\"token hvariable\">_</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Pixel</span> <span class=\"token number\">0xFFFFFF</span>\n<span class=\"token hvariable\">getPixel</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Hero</span> <span class=\"token hvariable\">_</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Pixel</span> <span class=\"token number\">0xFF0000</span>\n<span class=\"token hvariable\">getPixel</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Shot</span> <span class=\"token hvariable\">_</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Pixel</span> <span class=\"token number\">0xFFFF00</span></code></pre></div>\n<p>Here, you can see pattern matching in action:  A world item may either be an <strong>enemy</strong>, the <strong>hero</strong> or a <strong>shot</strong>. Based on this information I can now choose different rectangle sizes and different colours for the three different kinds of world items - adding new kinds of world items would be a trivial task. As a mostly OO programmer this does look quite a bit like a visitor pattern, only that this sort of pattern is pretty much first class in Haskell. </p>\n<p>Since I already found an abstraction to actors in this little game world, adding the shooting is a rather straightforward affair.</p>\n<div class=\"gatsby-highlight\" data-language=\"haskell\"><pre class=\"language-haskell\"><code class=\"language-haskell\"><span class=\"token hvariable\">shotsActor</span> <span class=\"token operator\">::</span> <span class=\"token constant\">World</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token constant\">World</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token constant\">WorldItem</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token hvariable\">shotsActor</span> <span class=\"token hvariable\">w</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">newState</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">heroShots</span> <span class=\"token hvariable\">newState</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">where</span>\n\t<span class=\"token hvariable\">newState</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">case</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">lastKey</span> <span class=\"token hvariable\">w</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">of</span>\n\t\t<span class=\"token constant\">SDLK_SPACE</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">w</span> <span class=\"token punctuation\">{</span> <span class=\"token hvariable\">heroShots</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">move</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">heroShots</span> <span class=\"token hvariable\">w</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">++</span> <span class=\"token punctuation\">[</span><span class=\"token hvariable\">newShot</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">lastKey</span> <span class=\"token operator\">=</span> <span class=\"token constant\">SDLK_UNKNOWN</span> <span class=\"token punctuation\">}</span>\n\t\t<span class=\"token hvariable\">_</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">w</span> <span class=\"token punctuation\">{</span> <span class=\"token hvariable\">heroShots</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">move</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">heroShots</span> <span class=\"token hvariable\">w</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\t<span class=\"token hvariable\">move</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">map</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">\\</span><span class=\"token punctuation\">(</span><span class=\"token constant\">Shot</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">x</span><span class=\"token punctuation\">,</span><span class=\"token hvariable\">y</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token constant\">Shot</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">x</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">y</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token hvariable\">newShot</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Shot</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">+</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">$</span> <span class=\"token hvariable\">getX</span> <span class=\"token operator\">$</span> <span class=\"token hvariable\">heroPosition</span> <span class=\"token hvariable\">w</span><span class=\"token punctuation\">,</span><span class=\"token number\">430</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The world data now has an additional property : <strong>heroShots :: [WorldItem]</strong>.\nThe new state is derived from whether the space key was pressed or not. In either case, the shots need to keep moving through the world, with the only difference that when pressing space, another shot is added to the list of existing shots. Finally, the last key value is erased to ensure that pressing space only fires a single shot. </p>\n<blockquote>\n<p>Just now while I am writing this I come to realize that I have no code to delete shots that are not inside the viewport anymore -\nfunny enough I never noticed any detrimental effect on performance while playing and frantically hitting the space key...</p>\n</blockquote>\n<p>While I am leaving the thing as it is, one can see implementation detail leakage in action: Deriving where a shot should appear assumes the size of our defender as well as his position. Nothing that couldn't be rectified, but I can live with that for now. </p>","fields":{"slug":"/2013/09/25/funspins-the-hero-shoots"},"frontmatter":{"date":"September 25, 2013","path":null,"title":"FunSpIns - The hero shoots.","tags":["programming","haskell","fun-spin"]}}},"pageContext":{"title":"FunSpIns - The hero shoots.","previous":{"fields":{"slug":"/2013/09/24/funspins-the-hero-must-move-the-enemies-must-move-smarter"},"frontmatter":{"title":"FunSpIns - The hero must move, the enemies must move smarter.","tags":["programming","haskell","fun-spin"],"date":"2013/09/24"}},"next":{"fields":{"slug":"/2013/09/26/funspins-collisions-the-dead-and-a-not-so-grateful-ending"},"frontmatter":{"title":"FunSpIns - Collisions, the dead, and a (not so) grateful ending.","tags":["programming","haskell","fun-spin"],"date":"2013/09/26"}}}}