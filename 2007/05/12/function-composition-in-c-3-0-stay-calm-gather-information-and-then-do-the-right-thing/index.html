<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/0.b6f99c9e0b431b23cfbb.css">/*! normalize.css v3.0.2 | MIT License | git.io/normalize */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}.container{position:relative;max-width:1260px;margin:0 auto;padding:0 20px}.column,.columns,.container{width:100%;box-sizing:border-box}.column,.columns{float:left}@media (min-width:400px){.container{width:85%;padding:0}}@media (min-width:550px){.container{width:80%}.column,.columns{margin-left:4%}.column:first-child,.columns:first-child{margin-left:0}.one.column,.one.columns{width:4.66666666667%}.two.columns{width:13.3333333333%}.three.columns{width:22%}.four.columns{width:30.6666666667%}.five.columns{width:39.3333333333%}.six.columns{width:48%}.seven.columns{width:56.6666666667%}.eight.columns{width:65.3333333333%}.nine.columns{width:74%}.ten.columns{width:82.6666666667%}.eleven.columns{width:91.3333333333%}.twelve.columns{width:100%;margin-left:0}.one-third.column{width:30.6666666667%}.two-thirds.column{width:65.3333333333%}.one-half.column{width:48%}.offset-by-one.column,.offset-by-one.columns{margin-left:8.66666666667%}.offset-by-two.column,.offset-by-two.columns{margin-left:17.3333333333%}.offset-by-three.column,.offset-by-three.columns{margin-left:26%}.offset-by-four.column,.offset-by-four.columns{margin-left:34.6666666667%}.offset-by-five.column,.offset-by-five.columns{margin-left:43.3333333333%}.offset-by-six.column,.offset-by-six.columns{margin-left:52%}.offset-by-seven.column,.offset-by-seven.columns{margin-left:60.6666666667%}.offset-by-eight.column,.offset-by-eight.columns{margin-left:69.3333333333%}.offset-by-nine.column,.offset-by-nine.columns{margin-left:78%}.offset-by-ten.column,.offset-by-ten.columns{margin-left:86.6666666667%}.offset-by-eleven.column,.offset-by-eleven.columns{margin-left:95.3333333333%}.offset-by-one-third.column,.offset-by-one-third.columns{margin-left:34.6666666667%}.offset-by-two-thirds.column,.offset-by-two-thirds.columns{margin-left:69.3333333333%}.offset-by-one-half.column,.offset-by-one-half.columns{margin-left:52%}}html{font-size:62.5%}body{font-size:1.5em;line-height:1.6;font-weight:400;font-family:Raleway,HelveticaNeue,Helvetica Neue,Helvetica,Arial,sans-serif;color:#222}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:2rem;font-weight:300}h1{font-size:4rem;line-height:1.2}h1,h2{letter-spacing:-.1rem}h2{font-size:3.6rem;line-height:1.25}h3{font-size:3rem;line-height:1.3;letter-spacing:-.1rem}h4{font-size:2.4rem;line-height:1.35;letter-spacing:-.08rem}h5{font-size:1.8rem;line-height:1.5;letter-spacing:-.05rem}h6{font-size:1.5rem;line-height:1.6;letter-spacing:0}@media (min-width:550px){h1{font-size:5rem}h2{font-size:4.2rem}h3{font-size:3.6rem}h4{font-size:3rem}h5{font-size:2.4rem}h6{font-size:1.5rem}}p{margin-top:0}a{color:#1eaedb}a:hover{color:#0fa0ce}.button,button,input[type=button],input[type=reset],input[type=submit]{display:inline-block;height:38px;padding:0 30px;color:#555;text-align:center;font-size:11px;font-weight:600;line-height:38px;letter-spacing:.1rem;text-transform:uppercase;text-decoration:none;white-space:nowrap;background-color:transparent;border-radius:4px;border:1px solid #bbb;cursor:pointer;box-sizing:border-box}.button:focus,.button:hover,button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{color:#333;border-color:#888;outline:0}.button.button-primary,button.button-primary,input[type=button].button-primary,input[type=reset].button-primary,input[type=submit].button-primary{color:#fff;background-color:#33c3f0;border-color:#33c3f0}.button.button-primary:focus,.button.button-primary:hover,button.button-primary:focus,button.button-primary:hover,input[type=button].button-primary:focus,input[type=button].button-primary:hover,input[type=reset].button-primary:focus,input[type=reset].button-primary:hover,input[type=submit].button-primary:focus,input[type=submit].button-primary:hover{color:#fff;background-color:#1eaedb;border-color:#1eaedb}input[type=email],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url],select,textarea{height:38px;padding:6px 10px;background-color:#fff;border:1px solid #d1d1d1;border-radius:4px;box-shadow:none;box-sizing:border-box}input[type=email],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url],textarea{-webkit-appearance:none;-moz-appearance:none;appearance:none}textarea{min-height:65px;padding-top:6px;padding-bottom:6px}input[type=email]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=url]:focus,select:focus,textarea:focus{border:1px solid #33c3f0;outline:0}label,legend{display:block;margin-bottom:.5rem;font-weight:600}fieldset{padding:0;border-width:0}input[type=checkbox],input[type=radio]{display:inline}label>.label-body{display:inline-block;margin-left:.5rem;font-weight:400}ul{list-style:circle inside}ol{list-style:decimal inside}ol,ul{padding-left:0;margin-top:0}ol ol,ol ul,ul ol,ul ul{margin:1.5rem 0 1.5rem 3rem;font-size:90%}li{margin-bottom:1rem}div.highlight{font-size:90%;white-space:nowrap;background:#f1f1f1;border:1px solid #e1e1e1;border-radius:4px;margin-bottom:2.5rem}code{padding:.2rem .5rem;margin:0 .2rem}pre>code{display:block;padding:1rem 1.5rem;white-space:pre}td,th{padding:12px 15px;text-align:left;border-bottom:1px solid #e1e1e1}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}.button,button{margin-bottom:1rem}fieldset,input,select,textarea{margin-bottom:1.5rem}blockquote,dl,figure,form,ol,p,pre,table,ul{margin-bottom:2.5rem}.u-full-width{width:100%;box-sizing:border-box}.u-max-full-width{max-width:100%;box-sizing:border-box}.u-pull-right{float:right}.u-pull-left{float:left}hr{margin-top:3rem;margin-bottom:3.5rem;border-width:0;border-top:1px solid #e1e1e1}.container:after,.row:after,.u-cf{content:"";display:table;clear:both}.highlight .hll{background-color:#ffc}.highlight .c{color:#999}.highlight .err{color:#a00;background-color:#faa}.highlight .k{color:#069}.highlight .o{color:#555}.highlight .cm{color:#09f;font-style:italic}.highlight .cp{color:#099}.highlight .c1,.highlight .cs{color:#999}.highlight .gd{background-color:#fcc;border:1px solid #c00}.highlight .ge{font-style:italic}.highlight .gr{color:red}.highlight .gh{color:#030}.highlight .gi{background-color:#cfc;border:1px solid #0c0}.highlight .go{color:#aaa}.highlight .gp{color:#009}.highlight .gu{color:#030}.highlight .gt{color:#9c6}.highlight .kc,.highlight .kd,.highlight .kn,.highlight .kp,.highlight .kr{color:#069}.highlight .kt{color:#078}.highlight .m{color:#f60}.highlight .s{color:#d44950}.highlight .na{color:#4f9fcf}.highlight .nb{color:#366}.highlight .nc{color:#0a8}.highlight .no{color:#360}.highlight .nd{color:#99f}.highlight .ni{color:#999}.highlight .ne{color:#c00}.highlight .nf{color:#c0f}.highlight .nl{color:#99f}.highlight .nn{color:#0cf}.highlight .nt{color:#2f6f9f}.highlight .nv{color:#033}.highlight .ow{color:#000}.highlight .w{color:#bbb}.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:#f60}.highlight .sb,.highlight .sc{color:#c30}.highlight .sd{color:#c30;font-style:italic}.highlight .s2,.highlight .se,.highlight .sh{color:#c30}.highlight .si{color:#a00}.highlight .sx{color:#c30}.highlight .sr{color:#3aa}.highlight .s1{color:#c30}.highlight .ss{color:#fc3}.highlight .bp{color:#366}.highlight .vc,.highlight .vg,.highlight .vi{color:#033}.highlight .il{color:#f60}.css .nt+.nt,.css .o,.css .o+.nt{color:#999}body{font-size:1.8em}h2,h4{font-size:2.6rem}@media (min-width:550px){h2,h4{font-size:2.7rem}}kbd{padding:.1em;border-radius:3px;border:1px solid #ccc;color:#333;display:inline-block;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 2px #fff;background-color:#f7f7f7;text-shadow:0 1px 0 #fff}figcaption{text-align:center;font-style:italic;color:#777;display:block;margin-bottom:2em}.sidebar h1{font-size:2.4em}.sidebar__sitetitle{color:#af0000}.sidebar__twitter{display:none;margin-top:2rem}.footer__twitter{display:none}.footer__copyright{float:right;font-size:.7em}.right-padded{padding-right:2rem}@media (max-width:550px){.sidebar h1,.sidebar p{margin-bottom:.5rem}.sidebar{padding-bottom:1rem;margin-bottom:1rem;border-bottom:1px solid grey}.footer__twitter{display:inline-block}}@media (min-width:550px){.sidebar h1{-webkit-transform:rotate(-90deg);transform:rotate(-90deg);text-align:right;margin-top:150px;margin-bottom:100px}.sidebar__twitter{display:block}.copyright{margin-top:40px}}.sidebar p{text-align:justify;font-size:.8em}.sidebar h1 a{text-decoration:none}nav a{display:block}.pagination{margin-top:20px}.center,.pagination{text-align:center}.expand{width:80%}.teaser{margin-bottom:70px}.teaser .date{display:block;margin-top:-20px;margin-bottom:20px;text-align:right}.teaser h3 a{text-decoration:none}.page-info{text-align:right;margin-bottom:40px}article iframe,article img{display:block;margin:20px auto;max-width:100%}article div.highlight,article iframe,article img{box-shadow:0 8px 16px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)}article div.highlight{scroll-behavior:auto}blockquote{background:#f9f9f9;border-left:10px solid #ccc;padding:.5em 10px;quotes:"\201C""\201D""\2018""\2019"}blockquote:before{color:#ccc;content:"\201D";font-size:4em;font-family:helvetica;line-height:.1em;margin-right:.25em;vertical-align:-.4em}div.seriestoc{background:#f9f9f9;border-left:10px solid #ccc;padding:.5em 10px;font-size:1em}div.seriestoc:before{color:#ccc;content:":";font-size:4em;font-family:helvetica;line-height:.1em;margin-right:.25em;vertical-align:-.4em}.blog-post__content>h3:first-of-type{text-align:right;border-radius:25px 25px 0 0;font-size:1.2em;background-color:#777;color:#fff;margin-bottom:0;padding:2px 20px 2px 0;font-style:italic}.blog-post__content>ol:first-of-type{list-style-type:upper-roman;background:#eff;border:1px solid #777;border-radius:0 0 25px 25px;margin-top:0;list-style-position:outside;padding:10px 10px 10px 45px}.blog-post__footer{margin:1rem 0 2rem}.article-tags{margin-left:.3rem}.article-tags--tag{margin-left:.5rem}.article-tags--tag:after{margin-left:.5rem;content:"|"}.article-tags--tag:last-child:after{content:""}.blog-post__pagination{display:flex;justify-content:space-between;margin-bottom:2rem}.blog-post__pagination--previous{text-decoration:none;margin:0 1rem}.blog-post__pagination--previous:hover{text-decoration:underline}.blog-post__pagination--previous:before{content:"\21A4   "}.blog-post__pagination--next:after{content:" \21A6"}.blog-post__pagination--next{text-decoration:none;margin:0 1rem}.blog-post__pagination--next:hover{text-decoration:underline}code.language-text{position:relative;padding:0;border-radius:.1em;margin-left:.2em;margin-right:.2em;color:#a55;border-bottom:1px solid rgba(200,100,100,.1);display:inline;white-space:normal}</style><style data-href="/app.a03716562d1e590f30ef.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{position:relative;margin:.5em 0;overflow:visible;padding:0}pre[class*=language-]>code{position:relative;border-left:10px solid #358ccb;box-shadow:-1px 0 0 0 #358ccb,0 0 0 1px #dfdfdf;background-color:#fdfdfd;background-image:linear-gradient(transparent 50%,rgba(69,142,209,.04) 0);background-size:3em 3em;background-origin:content-box;background-attachment:local}code[class*=language]{max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdfdfd;box-sizing:border-box;margin-bottom:1em}:not(pre)>code[class*=language-]{position:relative;padding:.2em;border-radius:.3em;color:#c92c2c;border:1px solid rgba(0,0,0,.1);display:inline;white-space:normal}pre[class*=language-]:after,pre[class*=language-]:before{content:"";z-index:-2;display:block;position:absolute;bottom:.75em;left:.18em;width:40%;height:20%;max-height:13em;box-shadow:0 13px 8px #979797;-webkit-transform:rotate(-2deg);transform:rotate(-2deg)}:not(pre)>code[class*=language-]:after,pre[class*=language-]:after{right:.75em;left:auto;-webkit-transform:rotate(2deg);transform:rotate(2deg)}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#7d8b99}.token.punctuation{color:#5f6364}.token.boolean,.token.constant,.token.deleted,.token.function-name,.token.number,.token.property,.token.symbol,.token.tag{color:#c92c2c}.token.attr-name,.token.builtin,.token.char,.token.function,.token.inserted,.token.selector,.token.string{color:#2f9c0a}.token.entity,.token.operator,.token.url,.token.variable{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.class-name,.token.keyword{color:#1990b8}.token.important,.token.regex{color:#e90}.language-css .token.string,.style .token.string{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.important{font-weight:400}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.namespace{opacity:.7}@media screen and (max-width:767px){pre[class*=language-]:after,pre[class*=language-]:before{bottom:14px;box-shadow:none}}.token.cr:before,.token.lf:before,.token.tab:not(:empty):before{color:#e0d7d1}pre[class*=language-].line-numbers.line-numbers{padding-left:0}pre[class*=language-].line-numbers.line-numbers code{padding-left:3.8em}pre[class*=language-].line-numbers.line-numbers .line-numbers-rows{left:0}pre[class*=language-][data-line]{padding-top:0;padding-bottom:0;padding-left:0}pre[data-line] code{position:relative;padding-left:4em}pre .line-highlight{margin-top:0}</style><meta name="generator" content="Gatsby 2.0.91"/><title data-react-helmet="true">Function composition in C#3.0 (Stay calm, gather information and then do the right thing)</title><link data-react-helmet="true" href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css"/><meta data-react-helmet="true" name="description" content="Content from Frank Quednau about dev and fields of interest."/><meta data-react-helmet="true" name="keywords" content="software-development, download, dotnet"/><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-87673c31a5b37b5e6556b63e1081ebbc.css"/><link rel="alternate" type="application/rss+xml" title="Realfiction RSS" href="/atom.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-f871525bee8584db0f33.js"/><link as="script" rel="preload" href="/app-aac9daccbcf99652fdfc.js"/><link as="script" rel="preload" href="/1-b800af6eeb94a4b43009.js"/><link as="script" rel="preload" href="/0-f5d65de208d5c75681bc.js"/><link as="script" rel="preload" href="/component---src-templates-article-template-js-0d50b129641477731f1b.js"/><link as="fetch" rel="preload" href="/static/d/496/path---2007-05-12-function-composition-in-c-3-0-stay-calm-gather-information-and-then-do-the-right-thing-bfd-389-xznVszQJQUnE4ih9Bo5ejh09uRI.json" crossOrigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="container"><div class="row"><div class="two columns right-padded"><div class="sidebar"><h1><a class="sidebar__sitetitle" href="/">Realfiction</a></h1><p>Content from Frank Quednau about dev and fields of interest.</p><nav><a href="/tags">Tags</a></nav><div class="sidebar__twitter"><a href="https://twitter.com/fquednau?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-show-count="false" data-show-screen-name="false">Follow @fquednau</a></div></div></div><div class="nine columns"><article><h1>Function composition in C#3.0 (Stay calm, gather information and then do the right thing)</h1><div class="page-info"><span>May 12, 2007</span> in<span class="article-tags"><a class="article-tags--tag" href="/tags/software-development">software-development</a><a class="article-tags--tag" href="/tags/download">download</a><a class="article-tags--tag" href="/tags/dotnet">dotnet</a></span></div><div class="blog-post__content"><p>In the <a href="/go/117">last post</a> I was talking about how we could create the natural Haskell function composition operator into C# and my first solution (also contained as the <em>Functional</em> assembly in the attached solution) was one based on the possibilities provided by the 2.0 Version of the .NET framework. It worked, but it was clumsy, with a lot infrastructure to support a single requirement.</p>
<p>Luckily I am already delving a bit into LINQ and the technologies behind it and respective implementations in different domains, e.g. <a href="http://www.google.de/search?hl=en&#x26;q=DLINQ+overview&#x26;btnG=Search">DLINQ</a> for doing strongly typed queries against DBs. If creating the query would already do anything against the DB, all hell would break loose considering that (D)LINQ allows for joins between objects. It would be bad news if you'd have to do the join in your application and not your DB.</p>
<p>Therefore, what rather happens is that a so-called <a href="http://www.interact-sw.co.uk/iangblog/2005/09/30/expressiontrees">expression tree</a> is generated. It conveys all the information that is expressed through writing down said query. Once the application really wants to perform a query, the frameworky bits of DLINQ can look at the created expression tree and create a decent SQL statement to get just that information without any excessive roundtripping.</p>
<p>Alas, expression trees are much more powerful than just being LINQ's backbone. They allow you to create new expressions, compile and use them at runtime. This is what is meant by deferred execution. You don't execute e.g. the LINQ query but rather gather the execution into an abstraction in order to be executed later. Now, that almost sounds like Haskell's lazy evaluation, doesn't it? Well, not quite, but the greatness of expression trees is that you can create new expressions, compile and use them at runtime. There, I just repeated myself. Why do I think that this is important? Go back to the <a href="/go/117">last post</a>. In imperative programming sometimes information is missing at a given point in time. A LINQ is finished and ready to be executed when the programmer says so. In my case the function composition is only finished when the programmer says so. Only then I have all necessary information to create the correct function composition.</p>
<p><strong>&#x3C;Stop blurbing, how does it work then?></strong></p>
<p>Let me just remind you the syntax of the function compositor. It stayed almost the same, as all the generics fun and method chaining makes for great type safety:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp">Func<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token operator">></span> func <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">FunctionalExpress</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FuncCombination</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>int2StringStatic<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>s <span class="token operator">=</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">AddFinal</span><span class="token punctuation">(</span>char2Decimal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">decimal</span> d <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now, however, I don't really have to store a reference to the passed delegate. I extract the info contained in the delegate and store it in a list that will be passed along the instances on which Add are called:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">delegate</span> V <span class="token generic-method"><span class="token function">Digestif</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span> List<span class="token operator">&lt;</span>MethodInfo<span class="token operator">></span> infos<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> FuncAddendum<span class="token operator">&lt;</span>START<span class="token punctuation">,</span> FINAL<span class="token punctuation">,</span> OUT<span class="token punctuation">,</span> NEWOUT<span class="token operator">></span> <span class="token generic-method"><span class="token function">Add</span><span class="token punctuation">&lt;</span><span class="token class-name">NEWOUT</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>Digestif<span class="token operator">&lt;</span>OUT<span class="token punctuation">,</span> NEWOUT<span class="token operator">></span> pluck<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  infos<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pluck<span class="token punctuation">.</span>Method<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">FuncAddendum</span><span class="token punctuation">&lt;</span><span class="token class-name">START</span><span class="token punctuation">,</span> <span class="token class-name">FINAL</span><span class="token punctuation">,</span> <span class="token class-name">OUT</span><span class="token punctuation">,</span> <span class="token class-name">NEWOUT</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>infos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Once AddFinal is called, something else happens:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> Func<span class="token operator">&lt;</span>START<span class="token punctuation">,</span>FINAL<span class="token operator">></span> <span class="token function">AddFinal</span><span class="token punctuation">(</span>Digestif<span class="token operator">&lt;</span>OUT<span class="token punctuation">,</span> FINAL<span class="token operator">></span> pluck<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  infos<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pluck<span class="token punctuation">.</span>Method<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">GetFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>At this point in time all information is available to combine the functions in an optimal fashion.
What we would do when chaining the functions in a normal fashion (i.e. when writing our source code) is essentially this:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp">type <span class="token function">myFuncComposition</span><span class="token punctuation">(</span>type <span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">last_method</span><span class="token punctuation">(</span><span class="token function">before_last_method</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>first <span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Only, we are already at runtime! Let's create the expression that looks like above instead. At the current state of the .NET framework 3.5 we use static methods of the Expression class to create different expressions (method calls, parameters, comparisons, additions, multiplications, etc., etc....).</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> Func<span class="token operator">&lt;</span>START<span class="token punctuation">,</span> FINAL<span class="token operator">></span> <span class="token function">GetFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name">ParameterExpression</span> pe <span class="token operator">=</span>
    Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span>infos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ParameterType<span class="token punctuation">,</span> infos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">MethodCallExpression</span> mce <span class="token operator">=</span> <span class="token function">BuildExpression</span><span class="token punctuation">(</span>infos<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pe<span class="token punctuation">)</span><span class="token punctuation">;</span>

  Expression<span class="token operator">&lt;</span>Func<span class="token operator">&lt;</span>START<span class="token punctuation">,</span> FINAL<span class="token operator">></span><span class="token operator">></span> myFunc <span class="token operator">=</span>
    Expression<span class="token punctuation">.</span>Lambda<span class="token operator">&lt;</span>Func<span class="token operator">&lt;</span>START<span class="token punctuation">,</span> FINAL<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span>mce<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ParameterExpression</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> pe <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> myFunc<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>For once we can make good use of the Enumerator as an object to pass along a recursive chain (Which is what I do, since the expression created from the first method is the input to the second method which is the input to the third...you get it).
The difference between the first and all other methods is that its input is the very same parameter that is the input to the function that will be generated once we compile the whole caboodle - which is why <strong>pe</strong> appears twice here. The last piece in the puzzle is the <strong>BuildExpression</strong> method:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token class-name">MethodCallExpression</span> <span class="token function">BuildExpression</span><span class="token punctuation">(</span>IEnumerator<span class="token operator">&lt;</span>MethodInfo<span class="token operator">></span> mis<span class="token punctuation">,</span> <span class="token class-name">Expression</span> ex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>mis<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">MethodCallExpression</span> intermediate <span class="token operator">=</span>
      Expression<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>mis<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>DeclaringType<span class="token punctuation">,</span> mis<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Expression</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> ex <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">BuildExpression</span><span class="token punctuation">(</span>mis<span class="token punctuation">,</span> intermediate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>MethodCallExpression<span class="token punctuation">)</span>ex<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And that's this. Once the recursion is finished, the Visual Studio shows us the ToString(), which gives a nice confirmation of what I was trying to achieve:</p>
<p><img src="/assets/func_expression.gif"></p>
<p>You can see, soon there are even more tools in the ever growing .NET toolbox. In some situations you may want to resort to create and compile some small-scale code at runtime - namely when you have all necessary information available to create just the right code to answer your requirement.</p>
<p>A final word to the function compositor provided in the attachment: It is currently able to call lambdas as well as static methods but no instance methods.</p></div><div class="blog-post__footer"><a href="https://mobile.twitter.com/search?q=https%3A%2F%2Frealfiction.net%2F2007/05/12/function-composition-in-c-3-0-stay-calm-gather-information-and-then-do-the-right-thing" target="_blank" rel="noopener noreferrer">Discuss on Twitter ⇲</a></div><div class="blog-post__pagination"><a class="blog-post__pagination--previous" href="/2007/05/10/how-much-haskell-can-i-squeeze-out-of-c">How much Haskell can I squeeze out of C#?</a><a class="blog-post__pagination--next" href="/2007/05/15/haunted-by-pi-changing-a-numbers-base-in-haskell">Haunted by PI - changing a number&#x27;s base in Haskell</a></div></article></div></div><div class="row"><div class="footer__twitter"><a href="https://twitter.com/fquednau?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-show-count="false" data-show-screen-name="false">Follow @fquednau</a> </div><p class="footer__copyright">© Frank Quednau <!-- -->2019</p></div></div></div></div><script>
  window.excludeGAPaths=[/^(?:\/404)$/];
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-1812710-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-article-template-js","jsonName":"2007-05-12-function-composition-in-c-3-0-stay-calm-gather-information-and-then-do-the-right-thing-bfd","path":"/2007/05/12/function-composition-in-c-3-0-stay-calm-gather-information-and-then-do-the-right-thing"};window.dataPath="496/path---2007-05-12-function-composition-in-c-3-0-stay-calm-gather-information-and-then-do-the-right-thing-bfd-389-xznVszQJQUnE4ih9Bo5ejh09uRI";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.a03716562d1e590f30ef.css","/app-aac9daccbcf99652fdfc.js"],"component---src-templates-article-template-js":["/component---src-templates-article-template-js-0d50b129641477731f1b.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-827eb0660badd62ebbc1.js"],"component---src-pages-404-js":["/component---src-pages-404-js-7de7581acfdeae5a1ab6.js"],"component---src-pages-index-js":["/component---src-pages-index-js-cc7c87d4d9fb6da3d023.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-bad0e5b91c4d33cf52ba.js"],"pages-manifest":["/pages-manifest-c95648889cb05c1bc439.js"]};/*]]>*/</script><script src="/component---src-templates-article-template-js-0d50b129641477731f1b.js" async=""></script><script src="/0-f5d65de208d5c75681bc.js" async=""></script><script src="/1-b800af6eeb94a4b43009.js" async=""></script><script src="/app-aac9daccbcf99652fdfc.js" async=""></script><script src="/webpack-runtime-f871525bee8584db0f33.js" async=""></script></body></html>