<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.6c827614bcd63144d6db.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}

/*! normalize.css v3.0.2 | MIT License | git.io/normalize */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}:root{--linkColorMain:#af0000;--linkColorMainContrast:#c6f8ff;--linkColor:#1eaedb;--linkHoverHighlight:#fff 0px 0px 5px,#7791b3 0px 0px 10px;--background:#fff;--sidePadding:0.75rem;--topShadow:0px 5px 7px 0px rgba(0,0,0,0.55);--lightSeparator:1px solid #d3d3d3;--standardShadow:0 8px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}body{font-size:1.5em;line-height:1.6;font-weight:400;font-family:Raleway,HelveticaNeue,Helvetica Neue,Helvetica,Arial,sans-serif;padding:0 var(--sidePadding) 0 var(--sidePadding)}a{color:var(--linkColor)}figcaption{text-align:center;font-style:italic;color:#777;display:block;margin-bottom:2em}img{display:block;margin:20px auto;max-width:100%;box-shadow:var(--standardShadow)}blockquote{background:#f9f9f9;border-left:10px solid #ccc;padding:.5rem 10px;quotes:"\201C""\201D""\2018""\2019"}blockquote:before{color:#ccc;content:"\201D";font-size:4em;font-family:helvetica;line-height:.1em;margin-right:.25em;vertical-align:-.4em}h1{font-size:2.1rem}h1,h2{line-height:1.2}h2{font-size:1.7rem}h3{line-height:1.2;letter-spacing:.05rem}h3,h4{font-size:1.5rem}h4{font-weight:lighter;font-style:italic}@media (min-width:768px){h1{font-size:2.5rem}h1,h2{line-height:1.3}h2{font-size:2rem}h3{line-height:1.1}h3,h4{font-size:1.7rem}}.layout-module--layout--3NElS{display:flex;flex-direction:column;align-items:center}.layout-module--main--1XJsu{padding:5rem 0 1rem;width:100%}@media (min-width:768px){.layout-module--main--1XJsu{width:90%}}@media (min-width:1200px){.layout-module--main--1XJsu{width:70%}}@media (min-width:2300px){.layout-module--main--1XJsu{width:55%}}.SiteHeader-module--siteNav--3VakG{display:flex;align-items:stretch;justify-content:center;padding:.5rem var(--sidePadding);box-shadow:var(--topShadow);background-color:var(--background);z-index:10;position:fixed;top:0;right:0;left:0}.SiteHeader-module--main--uZpGc{display:flex;flex-direction:row;justify-content:space-between;align-items:center;width:100%}.SiteHeader-module--siteHeader--3gDoz{font-family:Lora,serif;font-style:italic;letter-spacing:.01rem;text-shadow:2px 1px 1px #999;margin:0 1rem 0 0;font-size:2.2rem}.SiteHeader-module--mainLink---Exlm,.SiteHeader-module--siteLink--1QNau{text-decoration:none;display:inline-block}.SiteHeader-module--mainLink---Exlm:hover,.SiteHeader-module--siteLink--1QNau:hover{text-decoration:underline}.SiteHeader-module--mainLink---Exlm,.SiteHeader-module--mainLink---Exlm:visited,.SiteHeader-module--siteLink--1QNau,.SiteHeader-module--siteLink--1QNau:visited{color:var(--linkColorMain)}.SiteHeader-module--siteLink--1QNau:not(:first-child):before{content:" | ";color:#000;margin:0 .25rem;text-decoration:none;display:inline-block}@media (min-width:768px){.SiteHeader-module--main--uZpGc{width:90%}}@media (min-width:1200px){.SiteHeader-module--main--uZpGc{width:70%}}@media (min-width:2300px){.SiteHeader-module--main--uZpGc{width:55%}}.Footer-module--main--1QC0I{width:100%;display:flex;flex-direction:row;padding-top:.5rem;margin-bottom:2rem;justify-content:center;align-items:center;font-size:1rem;border-top:var(--lightSeparator)}.Footer-module--main--1QC0I img{margin:.25rem;box-shadow:none}.Footer-module--main--1QC0I p{margin:.25rem}@media (min-width:768px){.Footer-module--main--1QC0I{width:90%}}@media (min-width:1200px){.Footer-module--main--1QC0I{width:70%}}@media (min-width:2300px){.Footer-module--main--1QC0I{width:55%}}.tags-module--columnList--2IU2r{display:grid;list-style:circle inside;grid-auto-flow:row;grid-template-columns:repeat(auto-fill,300px);max-width:100%;font-size:1.2rem}.tags-module--columnList--2IU2r a{text-decoration:none}.tags-module--columnList--2IU2r a:hover{text-decoration:underline}.Tag-module--tags--3UNk1{margin-top:.5rem}.Tag-module--tag--3otWA{background-color:var(--linkColor);color:var(--linkColorMainContrast);text-decoration:none;font-size:1.1rem;margin-top:0;padding:.25rem}.Tag-module--tag--3otWA,.Tag-module--tagOuter--27OmX{border-top-right-radius:10px;border-bottom-right-radius:10px;border-top-left-radius:5px;border-bottom-left-radius:5px}.Tag-module--tagOuter--27OmX{display:inline-flex;margin:0 .5rem .5rem 0;padding:0;line-height:1.1rem;box-shadow:5px 5px 8px -8px rgba(0,0,0,.91)}.Tag-module--tagOuter--27OmX:hover{text-shadow:var(--linkHoverHighlight)}.Tag-module--tag--3otWA:after{margin-left:.75rem;font-size:1.5rem;vertical-align:middle;content:"â€¢"}.YouTubeEmbed-module--frame--JPpxk{display:block;margin:20px auto;width:516px;height:315px;max-width:100%;box-shadow:var(--standardShadow)}.Info-module--infoContainer--1O0oR,.Tweet-module--tweet--1nwF8{display:flex;justify-content:center}.Info-module--info--1Qfs3{background:#c6f8ff;border-left:10px solid var(--linkColor);padding:1rem .25rem;margin-bottom:2.5rem;box-shadow:var(--standardShadow);width:95%;quotes:"\201C""\201D""\2018""\2019"}div.Info-module--info--1Qfs3:before{color:var(--linkColor);content:"\24D8";font-size:2em;font-family:helvetica;line-height:.1em;margin-right:.25em;vertical-align:-.4em}@media (min-width:768px){.Info-module--info--1Qfs3{width:80%}}@media (min-width:1200px){.Info-module--info--1Qfs3{width:70%}}.DateDisplay-module--dateContainer--1trkw{align-self:flex-start;display:inline-grid;grid-template-columns:0 auto;grid-template-rows:auto auto;border:1px solid var(--linkColorMain);border-radius:5px}.DateDisplay-module--month--2KOka{font-size:1rem;line-height:1rem;text-align:center;padding:.25rem .5rem;display:block;grid-column:2;grid-row:1}.DateDisplay-module--date--oZxQz{display:flex;grid-column:2;grid-row:2;background-color:var(--linkColorMain);color:#fff;padding:.25rem 0;font-size:1.2rem;line-height:1.2rem;text-align:center;justify-self:stretch;justify-content:center;align-items:center}.DateDisplay-module--year--2577t{display:block;visibility:hidden;-ms-writing-mode:tb-lr;writing-mode:vertical-lr;grid-column:1;grid-row:1/span 2;padding:.25rem;line-height:1rem}.DateDisplay-module--excerpt--ac7UJ{font-size:1.4rem;margin:.25rem}@media (min-width:500px){.DateDisplay-module--dateContainer--1trkw{grid-template-columns:1.5rem 3rem}.DateDisplay-module--year--2577t{visibility:visible}}.postExcerpt-module--article--1YC-H{margin-bottom:3rem}.postExcerpt-module--article--1YC-H:last-of-type{margin-bottom:0}.postExcerpt-module--headerContainer--hcRy6{display:flex;flex-direction:row;align-items:center}.postExcerpt-module--header--1LVL4{font-size:1.7rem;line-height:2rem;margin:0 0 0 .5rem}.postExcerpt-module--header--1LVL4 a{text-decoration:none}.postExcerpt-module--header--1LVL4 a:hover{text-decoration:underline}.postExcerpt-module--dateContainer--3lfoy{align-self:flex-start;display:inline-grid;grid-template-columns:auto auto;grid-template-rows:auto auto;border:1px solid var(--linkColorMain);border-radius:5px}.postExcerpt-module--month--59SAH{font-size:1rem;line-height:1rem;text-align:center;padding:.25rem .5rem;display:block;grid-column:2;grid-row:1}.postExcerpt-module--date--2LGbD{display:block;grid-column:2;grid-row:2;background-color:var(--linkColorMain);color:#fff;padding:.25rem 0;font-size:1.2rem;line-height:1.2rem;text-align:center;justify-self:stretch}.postExcerpt-module--year--w1z16{display:block;-ms-writing-mode:tb-lr;writing-mode:vertical-lr;grid-column:1;grid-row:1/span 2;padding:.25rem;line-height:1rem}.postExcerpt-module--excerpt--2vlk7{font-size:1.4rem;margin:.25rem}.TopicToc-module--container--iTCNh{border-radius:25px;background:#f9f9f9;box-shadow:var(--standardShadow)}.TopicToc-module--header--23y04{text-align:right;border-top-left-radius:25px;border-top-right-radius:25px;font-size:1.2em;background-color:#777;color:#fff;margin-bottom:0;padding:2px 20px 2px 0;font-style:italic}.TopicToc-module--list--d3sjU{list-style-type:upper-roman;margin:1rem;padding-bottom:1rem;list-style-position:outside}.Discussion-module--alpha--2wwoE{margin-right:20%}.Discussion-module--beta--280lX{margin-left:20%}.Discussion-module--alpha--2wwoE:before{content:"Î·: Â«"}.Discussion-module--alpha--2wwoE:after,.Discussion-module--beta--280lX:after{content:"Â»"}.Discussion-module--beta--280lX:before{content:"Î¼: Â«"}.articleTemplate-module--header--354F0{display:grid;grid-template-rows:auto auto;grid-template-columns:auto auto;column-gap:.25rem;font-size:1.2rem;margin-bottom:2rem}.articleTemplate-module--date--2zr35{grid-column:2;grid-row:1;justify-self:end}.articleTemplate-module--h1--2QcXm{grid-row:1;grid-column:1;margin:0}.articleTemplate-module--tags--1YeyG{grid-row:2;grid-column:1/span 2}.PreviousAndNext-module--navigation--123UK{display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,auto);border:1px solid var(--linkColor);border-radius:5px}.PreviousAndNext-module--link--iq7Ea{display:flex;align-items:center;justify-content:center;padding:.25rem 1.5rem;background-color:var(--linkColor);color:var(--linkColorMainContrast);text-decoration:none;align-self:stretch;margin:.25rem;border-radius:5px}.PreviousAndNext-module--linkPrevious--2WFha{grid-column:1;grid-row:1}.PreviousAndNext-module--linkNext--3jMS3{grid-column:2;grid-row:1}.PreviousAndNext-module--disabled--oYrWw{opacity:.2}.PreviousAndNext-module--link--iq7Ea:hover{text-shadow:var(--linkHoverHighlight)}.PreviousAndNext-module--title--3-yUO{font-size:1rem;padding:0 .5rem}.PreviousAndNext-module--border--dT-B7{border-left:1px dashed var(--linkColor)}@media (min-width:768px){.PreviousAndNext-module--navigation--123UK{grid-template-columns:auto repeat(2,1fr) auto;grid-template-rows:auto}.PreviousAndNext-module--link--iq7Ea{margin:0;border-radius:0}.PreviousAndNext-module--linkPrevious--2WFha{grid-column:1}.PreviousAndNext-module--linkNext--3jMS3{grid-column:4}.PreviousAndNext-module--border--dT-B7{border-left:1px solid var(--linkColor)}}.tagTemplate-module--articleList--1XmWn{font-size:1.2rem;list-style:circle inside}.tagTemplate-module--articleList--1XmWn a,.tagTemplate-module--articleListHeader--3yVYd a{text-decoration:none}.tagTemplate-module--articleList--1XmWn a:hover,.tagTemplate-module--articleListHeader--3yVYd a:hover{text-decoration:underline}</style><meta name="generator" content="Gatsby 3.4.2"/><title data-react-helmet="true">Separating MS Bot&#x27;s soul from its body</title><link data-react-helmet="true" rel="preconnect" href="https://fonts.gstatic.com"/><link data-react-helmet="true" href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet"/><link data-react-helmet="true" href="//fonts.googleapis.com/css2?family=Lora:ital,wght@1,500&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Content from Frank Quednau about dev and fields of interest."/><meta data-react-helmet="true" name="keywords" content="dotnet, programming, azure, libs-and-frameworks"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Separating MS Bot&#x27;s soul from its body"/><meta data-react-helmet="true" name="twitter:site:id" content="fquednau"/><meta data-react-helmet="true" name="twitter:description" content="For  my new gig  I had the chance to look into  Microsoft&#x27;s Bot framework . Said framework exists to provide the foundation of setting up chatâ€¦"/><meta data-react-helmet="true" name="twitter:image" content="https://realfiction.net/icons/icon-72x72.png"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="Realfiction RSS" href="/atom.xml"/><link rel="icon" href="/favicon-32x32.png?v=4ebdacb62247bfbfe92c555d6c833c53" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4ebdacb62247bfbfe92c555d6c833c53"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4ebdacb62247bfbfe92c555d6c833c53"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4ebdacb62247bfbfe92c555d6c833c53"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4ebdacb62247bfbfe92c555d6c833c53"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4ebdacb62247bfbfe92c555d6c833c53"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4ebdacb62247bfbfe92c555d6c833c53"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4ebdacb62247bfbfe92c555d6c833c53"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4ebdacb62247bfbfe92c555d6c833c53"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link as="script" rel="preload" href="/webpack-runtime-8c66a71eaf271fdb6983.js"/><link as="script" rel="preload" href="/framework-75034fa8e3a9e81ff051.js"/><link as="script" rel="preload" href="/app-4efc4d6aa7df27a3a823.js"/><link as="script" rel="preload" href="/commons-5ffe1f2bcdc9b9fa2a3d.js"/><link as="script" rel="preload" href="/component---src-templates-article-template-js-f04abf4d737cf958b9a2.js"/><link as="fetch" rel="preload" href="/page-data/2017/06/25/separating-ms-bots-soul-from-its-body/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/256249292.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2581731408.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--layout--3NElS"><nav class="SiteHeader-module--siteNav--3VakG"><div class="SiteHeader-module--main--uZpGc"><h1 class="SiteHeader-module--siteHeader--3gDoz"><a class="SiteHeader-module--mainLink---Exlm" href="/">Realfiction</a></h1><div><a class="SiteHeader-module--siteLink--1QNau" href="/tags">Tags</a><a class="SiteHeader-module--siteLink--1QNau" href="/about">About</a></div></div></nav><main class="layout-module--main--1XJsu"><article><header class="articleTemplate-module--header--354F0"><time class="DateDisplay-module--dateContainer--1trkw articleTemplate-module--date--2zr35" dateTime="2017-06-25"><span class="DateDisplay-module--month--2KOka">Jun</span><span class="DateDisplay-module--date--oZxQz">25</span><span class="DateDisplay-module--year--2577t">2017</span></time><h1 class="articleTemplate-module--h1--2QcXm">Separating MS Bot&#x27;s soul from its body</h1><nav class="Tag-module--tags--3UNk1 articleTemplate-module--tags--1YeyG"><div class="Tag-module--tagOuter--27OmX"><a class="Tag-module--tag--3otWA" href="/tags/dotnet">dotnet</a></div><div class="Tag-module--tagOuter--27OmX"><a class="Tag-module--tag--3otWA" href="/tags/programming">programming</a></div><div class="Tag-module--tagOuter--27OmX"><a class="Tag-module--tag--3otWA" href="/tags/azure">azure</a></div><div class="Tag-module--tagOuter--27OmX"><a class="Tag-module--tag--3otWA" href="/tags/libs-and-frameworks">libs-and-frameworks</a></div></nav></header><p>For <a href="http://www.isolutions.ch/Seiten/default.aspx">my new gig</a> I had the chance to look into <a href="https://dev.botframework.com/">Microsoft&#x27;s Bot framework</a>. Said framework exists to</p><ul><li>provide the foundation of setting up chat <em>Dialogs</em>, similarly to how you would set up screen flows.</li><li>Through its mechanisms of (de)serialization provide a suspendable state machine to keep a conversation with the user going and wire up necessary services like pre-canned dialogs or intention revealing services like <a href="https://www.luis.ai/home/index">LUIS</a></li><li>Through the registration in the bot portal provide the basis of having bots serve multiple channels (think web, but also slack, Skype, Skype for Business, etc.)</li></ul><p>The bot API comes in two flavours:</p><h3>The &quot;IDialog Of T&quot; interface</h3><p>This is the basic building block of bots. Based on this interface you can package your functionality like MS has done it for example with the in-built Form dialog that will ask questions dictated by the shape of a provided object or the <a href="https://github.com/Microsoft/BotBuilder-Location">location dialog</a>, a pre-canned dialog to collect location data within a conversation with the help of Bing Maps. The type argument of a Dialog refers to its return value. In the case of the location dialog this is e.g. a <strong>Place</strong> object.</p><h3>The Chain fluent API</h3><p>This API allows to chain those callbacks, switches and similar things that you would usually place into a Dialog as lambdas and such construct a bot without having to explicitly define Dialogs yourself.</p><p>My main quarrel with the API is that back in your mind you always need to consider that your Dialog must be serializable. This puts a few restrictions on your design, e.g. how you treat your injected services. Also, with the default serializer you will run into trouble when in your continuations, which you usually express as lambdas, you try to access an instance field of the dialog. In this case the serialization system will just complain bitterly that you simply cannot do that. To get out of that problem, your continuations get access to the state data through an interface passed in.</p><p>Another thing is that the API does not make it easy for you to separate the <em>&quot;soul&quot;</em> of your Dialog, the business logic, from the necessary plumbing of the Dialog API, nor is there any guidance on how to do that.</p><p>Granted, all dependencies are accessible through interfaces, such that an <code class="language-text">IDialog</code> implementation is in theory testable. However, you&#x27;ll still have the issue of having a class whose structure is predominantly shaped by the technicalities of the Bot API while containing the logic of your conversation.</p><p>What follows is one way to get that separation done. The idea is to define a <em>Saga</em>, where I am using the word in the sense as it is <a href="https://docs.particular.net/nservicebus/sagas/">introduced e.g. by NServiceBus</a>.</p><h3>the bot&#x27;s body</h3><p>Let us introduce an IDialog implementation that supports kicking off a so-called <strong>Customer Saga</strong>.</p><div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerSagaDrivenDialog<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDialog<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span></span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICustomerSaga</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">StartAsync</span><span class="token punctuation">(</span><span class="token class-name">IDialogContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> customerSaga <span class="token operator">=</span> Conversation<span class="token punctuation">.</span>Container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">SetSaga</span><span class="token punctuation">(</span>customerSaga<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span>WaitForUserToStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICustomerSaga</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ProcessResponse<span class="token punctuation">&gt;</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>The container (which btw is an AutoFac container, i.e. thank the decent engineers working on this that it&#x27;s not Unity) resolves our Saga and is directly put into the <strong>context</strong>. Context is an object which also implements <code class="language-text">IBotData</code>, an interface which abstracts away the access to data which consitutes the state of your conversation and user interaction. Then we wait for the user to talk to our bot. Once this happens...</p><div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp">
<span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">WaitForUserToStart</span><span class="token punctuation">(</span><span class="token class-name">IDialogContext</span> context<span class="token punctuation">,</span> <span class="token class-name">IAwaitable<span class="token punctuation">&lt;</span>IMessageActivity<span class="token punctuation">&gt;</span></span> result<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> r <span class="token operator">=</span> <span class="token keyword">await</span> result<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>ConversationData<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span><span class="token string">&quot;saga&quot;</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">T</span> saga<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> whatNext <span class="token operator">=</span> <span class="token keyword">await</span> saga<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">HandleWhatNext</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> whatNext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We await the result that contains amongst other info the user&#x27;s input, obtain/deserialize the saga from the bot&#x27;s state, and call the <strong>Start</strong> method of the saga with the user&#x27;s input. <strong>whatNext</strong> is just a sloppy name for an object that will help us to dispatch what should happen next in the dialog.</p><div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">HandleWhatNext</span><span class="token punctuation">(</span><span class="token class-name">IDialogContext</span> context<span class="token punctuation">,</span> <span class="token class-name">ProcessResponse</span> whatNext<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    whatNext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Being</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ContinuedResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>SetContinuation<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>whatNext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token class-name">TerminateDialog</span> td<span class="token punctuation">:</span> <span class="token range operator">..</span><span class="token punctuation">.</span>
        <span class="token keyword">case</span> <span class="token class-name">AskForAddress</span> afa<span class="token punctuation">:</span> <span class="token range operator">..</span><span class="token punctuation">.</span>
        <span class="token keyword">case</span> <span class="token class-name">PromptResponse</span> pr<span class="token punctuation">:</span>
            PromptDialog<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dialogContext<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> result<span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> continuation <span class="token operator">=</span> <span class="token keyword">await</span> dialogContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CallContinuation</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">HandleWhatNext</span><span class="token punctuation">(</span>dialogContext<span class="token punctuation">,</span> continuation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> pr<span class="token punctuation">.</span>Prompt<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p><code class="language-text">ProcessResponse</code> is the name of the abstract class from which all actions emanating from the Saga inherit. With the new switch enhancement we can now also pattern-match on the actual return type halfway decently even in C#. Also of note is the first line that will store the continuation of said action <strong>if</strong> the action is a <code class="language-text">ContinuedResponse</code>. All <code class="language-text">ProcessResponse</code> types are a <code class="language-text">ContinuedResponse</code> apart from those that, well, end the dialog and hence have no continuation, e.g. the <code class="language-text">TerminateDialog</code> type.</p><p>The code above shows one example how the Saga&#x27;s action is handled. Here, a Bot Dialog helper is used to prompt the user with some text, then, with the user&#x27;s response the continuation is called that had previously been stored in the context.</p><p>What happens in <code class="language-text">CallContinuation</code>?</p><div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ProcessResponse<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CallContinuation</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IDialogContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> input<span class="token punctuation">)</span> 
    <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span>  <span class="token type-list"><span class="token class-name">ICustomerSaga</span></span>
<span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>ConversationData<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span><span class="token string">&quot;saga&quot;</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">T</span> saga<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>ConversationData<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span><span class="token string">&quot;continuation&quot;</span><span class="token punctuation">,</span> 
        <span class="token keyword">out</span> <span class="token class-name">ContinuedResponse</span> continuation<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> <span class="token keyword">await</span> continuation<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>saga<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// The saga may have changed its internal state and </span>
        <span class="token comment">// wants back into the bag</span>
        ctx<span class="token punctuation">.</span><span class="token function">SetSaga</span><span class="token punctuation">(</span>saga<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ProcessResponse<span class="token punctuation">.</span>NoOp<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>Here the saga is taken from the context as well as a previously stored continuation. Once both are obtained, the continuation is called with the current input that has been provided by the bot framework. This could be a simple text from the user, or some complex object from some child dialog that has just completed. Also of importance is that after having obtained the next action from the Saga, the saga is put back into its box, as it may have changed its internal state (which is kind of the whole point of a Saga).</p><p>In the continuation call we get a little bit dirty:</p><div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ProcessResponse<span class="token punctuation">&gt;</span></span> <span class="token function">Call</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> saga<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> input<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> method <span class="token operator">=</span> saga<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetMethod</span><span class="token punctuation">(</span>Continuation<span class="token punctuation">,</span> 
      BindingFlags<span class="token punctuation">.</span>Instance <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>Public <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>NonPublic<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromResult</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ProcessResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TerminateDialog</span> <span class="token punctuation">{</span> 
                Text <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;Failure to identify a continuation from </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Continuation</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> 
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>saga<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> input <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>Task<span class="token operator">&lt;</span>ProcessResponse<span class="token operator">&gt;</span><span class="token punctuation">)</span>result<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>A sprinkle of reflection helps us break the chains of serialization. My first attempt had been to store an actual delegate
as continuation, but since those continuations need to be serializable, the default serializer was in deep trouble with those.
Hence the necessary weakening of compile-time safety.</p><p>Now that we have covered the <em>body</em>, let&#x27;s look at the bot&#x27;s <em>soul</em>.</p><h3>the bot&#x27;s soul</h3><p>Let us look at the setup of the Saga:</p><div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeSaga</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICustomerSaga</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">IIntentRecognition</span> _intentRecognition<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">SomeState</span> State <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">UsedImplicitly</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token function">AddressChangeSaga</span><span class="token punctuation">(</span><span class="token class-name">IIntentRecognition</span> intentRecognition<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _intentRecognition <span class="token operator">=</span> intentRecognition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">OnDeserialized</span></span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDeserialized</span><span class="token punctuation">(</span><span class="token class-name">StreamingContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _intentRecognition <span class="token operator">=</span> Conversation<span class="token punctuation">.</span>Container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IIntentRecognition<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre></div><p>The deserialize hook is where things are ugly. The bot framework does not seem to use AutoFac to pull a bot state item
back into life, hence we cannot trust our dependencies to be correctly injected in this situation. That is where the deserialize hook comes into play and <em>&quot;injects&quot;</em> the dependencies into the Saga. Thankfully this doesn&#x27;t cause much problems in testing since there we can create the Saga as usual through its constructor.</p><p>Finally, let us look into the Saga&#x27;s Start method:</p><div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ProcessResponse<span class="token punctuation">&gt;</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> intent <span class="token operator">=</span> <span class="token keyword">await</span> _intentRecognition<span class="token punctuation">.</span><span class="token function">FigureOutIntent</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>intent<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">case</span> UserIntent<span class="token punctuation">.</span>Greeting<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PromptRespons</span>
                Prompt <span class="token operator">=</span> BotTexts<span class="token punctuation">.</span>GreetingText<span class="token punctuation">,</span> 
                Continuation <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>Start<span class="token punctuation">)</span> 
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> UserIntent<span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PromptResponse</span> <span class="token punctuation">{</span> 
                Prompt <span class="token operator">=</span> BotTexts<span class="token punctuation">.</span>QuestionForNameText<span class="token punctuation">,</span> 
                Continuation <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>FindCustomer<span class="token punctuation">)</span> 
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TerminateDialog</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> <span class="token string">&quot;Woa, you got me there \U0001F937.&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>As you can see the <em>soul</em> of the dialog is now decoupled from the Dialog&#x27;s mechanics. The <code class="language-text">nameof</code> helps us to alleviate the pain of necessary reflection by keeping refactoring support going and helping us pick the right method to continue to.</p><p>Where we still need to keep an eye on is that the type of the argument to the continuation matches the requirements, e.g. here, after a user has provided us with an address:</p><div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ProcessResponse<span class="token punctuation">&gt;</span></span> <span class="token function">AddressObtained</span><span class="token punctuation">(</span><span class="token class-name">Place</span> place<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
        <span class="token keyword">await</span> _someService<span class="token punctuation">.</span><span class="token function">UpdateAddress</span><span class="token punctuation">(</span>place<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TerminateDialog</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> BotTexts<span class="token punctuation">.</span>AddressUpdatedAndProcessFinishedText <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TerminateDialog</span> <span class="token punctuation">{</span> Text <span class="token operator">=</span> BotTexts<span class="token punctuation">.</span>FailedToStoreAddressText <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>It seems like quite a bit of work, considering that <code class="language-text">IDialog</code> implementations are indeed testable by virtue of all dependencies being interfaces. But consider this: A conversational interaction with a user will be full of branching, fallbacks, a lot of dispatching and state keeping. I am farily convinced that it makes sense to decouple conversation logic
from the bot infrastructure, because stuff will get <strong>complicated quite quickly</strong> and what better way to tame complexity than to separate concerns. </p></article><nav class="PreviousAndNext-module--navigation--123UK"><a class="PreviousAndNext-module--linkPrevious--2WFha PreviousAndNext-module--link--iq7Ea" aria-describedby="previousTitle" href="/2017/06/24/eleven-year-old-svg-engine-reposted">&lt;</a><span id="previousTitle" class="PreviousAndNext-module--title--3-yUO">eleven year old svg engine, reposted</span><span id="nextTitle" class="PreviousAndNext-module--title--3-yUO PreviousAndNext-module--border--dT-B7">Amazing morse writing</span><a class="PreviousAndNext-module--linkNext--3jMS3 PreviousAndNext-module--link--iq7Ea" aria-describedby="nextTitle" href="/2017/07/02/amazing-morse-writing">&gt;</a></nav></main><footer class="Footer-module--main--1QC0I"><a rel="license noopener noreferrer" target="_new" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"/></a><p>Frank Quednau <!-- -->2021</p></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  window.excludeGAPaths=[/^(?:\/404)$/];
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-1812710-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2017/06/25/separating-ms-bots-soul-from-its-body";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-72b219bae196683411be.js"],"app":["/app-4efc4d6aa7df27a3a823.js"],"component---src-pages-404-js":["/component---src-pages-404-js-65e0e6024a51ef90147e.js"],"component---src-pages-about-js":["/component---src-pages-about-js-938610e8d1e33912361f.js"],"component---src-pages-index-js":["/component---src-pages-index-js-af6f54d0700b918d2163.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-289c177ccd69332b3e3d.js"],"component---src-templates-article-template-js":["/component---src-templates-article-template-js-f04abf4d737cf958b9a2.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-1d9c79df7cff12c7ff91.js"]};/*]]>*/</script><script src="/polyfill-72b219bae196683411be.js" nomodule=""></script><script src="/component---src-templates-article-template-js-f04abf4d737cf958b9a2.js" async=""></script><script src="/commons-5ffe1f2bcdc9b9fa2a3d.js" async=""></script><script src="/app-4efc4d6aa7df27a3a823.js" async=""></script><script src="/framework-75034fa8e3a9e81ff051.js" async=""></script><script src="/webpack-runtime-8c66a71eaf271fdb6983.js" async=""></script></body></html>